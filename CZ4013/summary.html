<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>CZ4013 Distributed Systems Summary</title>
<!-- 2018-04-27 Fri 16:02 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Eric Leonardo Lim" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" href="worg.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">CZ4013 Distributed Systems Summary</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Tasks</a>
<ul>
<li><a href="#sec-1-1">1.1. <span class="todo TODO">TODO</span> Chandy &amp; Lamport Algorithm at Global States</a></li>
<li><a href="#sec-1-2">1.2. <span class="todo TODO">TODO</span> Data-Centric Consistency Models &amp; Protocols</a></li>
<li><a href="#sec-1-3">1.3. <span class="todo TODO">TODO</span> Complete document (2 sections left)</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Introduction</a>
<ul>
<li><a href="#sec-2-1">2.1. What is DS?</a>
<ul>
<li><a href="#sec-2-1-1">2.1.1. Definition</a></li>
</ul>
</li>
<li><a href="#sec-2-2">2.2. Fundamental Characteristics of DS</a>
<ul>
<li><a href="#sec-2-2-1">2.2.1. Concurrency</a></li>
<li><a href="#sec-2-2-2">2.2.2. Loosely coupled</a></li>
<li><a href="#sec-2-2-3">2.2.3. Independent failures</a></li>
</ul>
</li>
<li><a href="#sec-2-3">2.3. Main Motivation of DS: Resource Sharing</a>
<ul>
<li><a href="#sec-2-3-1">2.3.1. Description</a></li>
<li><a href="#sec-2-3-2">2.3.2. Service</a></li>
<li><a href="#sec-2-3-3">2.3.3. Server</a></li>
<li><a href="#sec-2-3-4">2.3.4. Client</a></li>
<li><a href="#sec-2-3-5">2.3.5. Remote Invocation</a></li>
</ul>
</li>
<li><a href="#sec-2-4">2.4. DS Issues and Problems</a>
<ul>
<li><a href="#sec-2-4-1">2.4.1. Heterogeneity</a></li>
<li><a href="#sec-2-4-2">2.4.2. Scalability</a></li>
<li><a href="#sec-2-4-3">2.4.3. Failure handling</a></li>
</ul>
</li>
<li><a href="#sec-2-5">2.5. Architectural Models</a>
<ul>
<li><a href="#sec-2-5-1">2.5.1. SW and HW layers (vertical)</a></li>
<li><a href="#sec-2-5-2">2.5.2. System architectures (horizontal)</a></li>
</ul>
</li>
<li><a href="#sec-2-6">2.6. Fundamental Models</a>
<ul>
<li><a href="#sec-2-6-1">2.6.1. Interaction Model</a></li>
<li><a href="#sec-2-6-2">2.6.2. Failure Model</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3">3. Interprocess Communication</a>
<ul>
<li><a href="#sec-3-1">3.1. External Data Representation &amp; Mashalling</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1. Marshal &amp; Unmarshal</a></li>
<li><a href="#sec-3-1-2">3.1.2. CORBA's Common Data Representation</a></li>
<li><a href="#sec-3-1-3">3.1.3. Java object serialization</a></li>
</ul>
</li>
<li><a href="#sec-3-2">3.2. Client-Server Communication</a>
<ul>
<li><a href="#sec-3-2-1">3.2.1. Reliability</a></li>
<li><a href="#sec-3-2-2">3.2.2. UDP</a></li>
<li><a href="#sec-3-2-3">3.2.3. TCP</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">4. Distributed Objects &amp; Remote Invocation</a>
<ul>
<li><a href="#sec-4-1">4.1. Object Model</a></li>
<li><a href="#sec-4-2">4.2. Distributed Object Model</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1. Description</a></li>
<li><a href="#sec-4-2-2">4.2.2. Invocation Semantics</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3. Architecture of RMI</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. Proxy</a></li>
<li><a href="#sec-4-3-2">4.3.2. Communication Modules</a></li>
<li><a href="#sec-4-3-3">4.3.3. Skeleton</a></li>
<li><a href="#sec-4-3-4">4.3.4. Binder</a></li>
<li><a href="#sec-4-3-5">4.3.5. Description</a></li>
</ul>
</li>
<li><a href="#sec-4-4">4.4. Java RMI Example</a>
<ul>
<li><a href="#sec-4-4-1">4.4.1. Polling</a></li>
<li><a href="#sec-4-4-2">4.4.2. Callback</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. Distributed File Systems</a>
<ul>
<li><a href="#sec-5-1">5.1. Introduction</a>
<ul>
<li><a href="#sec-5-1-1">5.1.1. File System</a></li>
<li><a href="#sec-5-1-2">5.1.2. Distributed File System</a></li>
</ul>
</li>
<li><a href="#sec-5-2">5.2. Sun NFS</a>
<ul>
<li><a href="#sec-5-2-1">5.2.1. Overview</a></li>
<li><a href="#sec-5-2-2">5.2.2. Architecture</a></li>
<li><a href="#sec-5-2-3">5.2.3. Client-Server Communication</a></li>
<li><a href="#sec-5-2-4">5.2.4. Client Caching</a></li>
</ul>
</li>
<li><a href="#sec-5-3">5.3. AFS and Code File Systems</a>
<ul>
<li><a href="#sec-5-3-1">5.3.1. Overview</a></li>
<li><a href="#sec-5-3-2">5.3.2. AFS Architecture</a></li>
<li><a href="#sec-5-3-3">5.3.3. Whole-File Serving and Caching</a></li>
<li><a href="#sec-5-3-4">5.3.4. Coda File System</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-6">6. P2P File Sharing Systems</a>
<ul>
<li><a href="#sec-6-1">6.1. Introduction</a></li>
<li><a href="#sec-6-2">6.2. Examples</a>
<ul>
<li><a href="#sec-6-2-1">6.2.1. File sharing</a></li>
<li><a href="#sec-6-2-2">6.2.2. Communication</a></li>
<li><a href="#sec-6-2-3">6.2.3. DHT</a></li>
</ul>
</li>
<li><a href="#sec-6-3">6.3. Unstructured P2P File Sharing</a>
<ul>
<li><a href="#sec-6-3-1">6.3.1. Overview</a></li>
<li><a href="#sec-6-3-2">6.3.2. Napster</a></li>
<li><a href="#sec-6-3-3">6.3.3. Gnutella</a></li>
<li><a href="#sec-6-3-4">6.3.4. KaZaA</a></li>
</ul>
</li>
<li><a href="#sec-6-4">6.4. Structured DHT Systems</a>
<ul>
<li><a href="#sec-6-4-1">6.4.1. Overview</a></li>
<li><a href="#sec-6-4-2">6.4.2. DHT Services</a></li>
<li><a href="#sec-6-4-3">6.4.3. Consistent Hashing</a></li>
<li><a href="#sec-6-4-4">6.4.4. Chord</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-7">7. Name Services</a>
<ul>
<li><a href="#sec-7-1">7.1. Names and Name Services</a>
<ul>
<li><a href="#sec-7-1-1">7.1.1. Names and Addresses</a></li>
<li><a href="#sec-7-1-2">7.1.2. Name Service</a></li>
<li><a href="#sec-7-1-3">7.1.3. Main Requirements</a></li>
<li><a href="#sec-7-1-4">7.1.4. Namespace</a></li>
<li><a href="#sec-7-1-5">7.1.5. Name Resolution Process</a></li>
<li><a href="#sec-7-1-6">7.1.6. Iterative Client-Controlled Navigation</a></li>
<li><a href="#sec-7-1-7">7.1.7. Nonrecursive Server-Controlled Navigation</a></li>
<li><a href="#sec-7-1-8">7.1.8. Recursive Server-Controlled Navigation</a></li>
</ul>
</li>
<li><a href="#sec-7-2">7.2. Domain Name System</a>
<ul>
<li><a href="#sec-7-2-1">7.2.1. Overview</a></li>
<li><a href="#sec-7-2-2">7.2.2. Hierarchical Name Space</a></li>
<li><a href="#sec-7-2-3">7.2.3. Name Space Partitioning</a></li>
<li><a href="#sec-7-2-4">7.2.4. DNS Name Servers</a></li>
<li><a href="#sec-7-2-5">7.2.5. DNS Queries</a></li>
<li><a href="#sec-7-2-6">7.2.6. Replication for Reliability</a></li>
<li><a href="#sec-7-2-7">7.2.7. DNS Name Resolution Process</a></li>
<li><a href="#sec-7-2-8">7.2.8. Caching</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-8">8. Time and Global States</a>
<ul>
<li><a href="#sec-8-1">8.1. Synchronizing Physical Clocks</a>
<ul>
<li><a href="#sec-8-1-1">8.1.1. Computer Clocks</a></li>
<li><a href="#sec-8-1-2">8.1.2. Cristian's Method</a></li>
<li><a href="#sec-8-1-3">8.1.3. Berkeley Algorithm</a></li>
<li><a href="#sec-8-1-4">8.1.4. NTP</a></li>
</ul>
</li>
<li><a href="#sec-8-2">8.2. Causal Ordering and Logical Clocks</a>
<ul>
<li><a href="#sec-8-2-1">8.2.1. System model</a></li>
<li><a href="#sec-8-2-2">8.2.2. Causal Ordering</a></li>
<li><a href="#sec-8-2-3">8.2.3. Lamport's Logical Clocks</a></li>
<li><a href="#sec-8-2-4">8.2.4. Vector Clocks</a></li>
</ul>
</li>
<li><a href="#sec-8-3">8.3. Global States</a>
<ul>
<li><a href="#sec-8-3-1">8.3.1. Motivation</a></li>
<li><a href="#sec-8-3-2">8.3.2. System Model</a></li>
<li><a href="#sec-8-3-3">8.3.3. Consistent Cut</a></li>
<li><a href="#sec-8-3-4">8.3.4. Recording Snapshot</a></li>
<li><a href="#sec-8-3-5">8.3.5. Chandy &amp; Lamport Algorithm</a></li>
</ul>
</li>
<li><a href="#sec-8-4">8.4. Distributed Debugging</a>
<ul>
<li><a href="#sec-8-4-1">8.4.1. Description</a></li>
<li><a href="#sec-8-4-2">8.4.2. Lattice of Consistent Global States</a></li>
<li><a href="#sec-8-4-3">8.4.3. Observing Consistent Global States</a></li>
<li><a href="#sec-8-4-4">8.4.4. Global State Consistency Theorem</a></li>
<li><a href="#sec-8-4-5">8.4.5. Debugging</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-9">9. Coordination and Agreement</a>
<ul>
<li><a href="#sec-9-1">9.1. Introduction</a></li>
<li><a href="#sec-9-2">9.2. Distributed Mutex</a>
<ul>
<li><a href="#sec-9-2-1">9.2.1. Overview</a></li>
<li><a href="#sec-9-2-2">9.2.2. System Model</a></li>
<li><a href="#sec-9-2-3">9.2.3. Requirements</a></li>
<li><a href="#sec-9-2-4">9.2.4. Performance Metrics</a></li>
<li><a href="#sec-9-2-5">9.2.5. Central Server Algorithm</a></li>
<li><a href="#sec-9-2-6">9.2.6. Ring-Based Algorithms</a></li>
<li><a href="#sec-9-2-7">9.2.7. Ricart and Agrawala Algorithm</a></li>
</ul>
</li>
<li><a href="#sec-9-3">9.3. Election</a>
<ul>
<li><a href="#sec-9-3-1">9.3.1. Introduction</a></li>
<li><a href="#sec-9-3-2">9.3.2. Performance Metrics</a></li>
<li><a href="#sec-9-3-3">9.3.3. Ring-Based Algorithm</a></li>
<li><a href="#sec-9-3-4">9.3.4. Bully Algorithm</a></li>
</ul>
</li>
<li><a href="#sec-9-4">9.4. Consensus Problem</a>
<ul>
<li><a href="#sec-9-4-1">9.4.1. Introduction</a></li>
<li><a href="#sec-9-4-2">9.4.2. System Model</a></li>
<li><a href="#sec-9-4-3">9.4.3. Requirements</a></li>
<li><a href="#sec-9-4-4">9.4.4. Synchronous</a></li>
<li><a href="#sec-9-4-5">9.4.5. Asynchronous = Impossible</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-10">10. Replication and Consistency</a>
<ul>
<li><a href="#sec-10-1">10.1. Introduction</a></li>
<li><a href="#sec-10-2">10.2. System Model</a>
<ul>
<li><a href="#sec-10-2-1">10.2.1. Static vs Dynamic</a></li>
<li><a href="#sec-10-2-2">10.2.2. Transparency</a></li>
<li><a href="#sec-10-2-3">10.2.3. Data operations</a></li>
<li><a href="#sec-10-2-4">10.2.4. Possible failures</a></li>
<li><a href="#sec-10-2-5">10.2.5. Consistency model</a></li>
</ul>
</li>
<li><a href="#sec-10-3">10.3. Data-Centric Consistency Models</a>
<ul>
<li><a href="#sec-10-3-1">10.3.1. Overview</a></li>
<li><a href="#sec-10-3-2">10.3.2. Strict concurrency</a></li>
<li><a href="#sec-10-3-3">10.3.3. Sequential concurrency</a></li>
<li><a href="#sec-10-3-4">10.3.4. Causal and FIFO</a></li>
</ul>
</li>
<li><a href="#sec-10-4">10.4. Data-Centric Consistency Protocols</a>
<ul>
<li><a href="#sec-10-4-1">10.4.1. Description</a></li>
<li><a href="#sec-10-4-2">10.4.2. Primary-Based Protocols</a></li>
<li><a href="#sec-10-4-3">10.4.3. Replicated-Write Protocols</a></li>
</ul>
</li>
<li><a href="#sec-10-5">10.5. Client-Centric Consistency Models</a>
<ul>
<li><a href="#sec-10-5-1">10.5.1. Overview</a></li>
<li><a href="#sec-10-5-2">10.5.2. Monotonic reads</a></li>
<li><a href="#sec-10-5-3">10.5.3. Monotonic writes</a></li>
<li><a href="#sec-10-5-4">10.5.4. Read your writes</a></li>
<li><a href="#sec-10-5-5">10.5.5. Writes follow reads</a></li>
</ul>
</li>
<li><a href="#sec-10-6">10.6. Client-Centric Consistency Protocols</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Tasks</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> <span class="todo TODO">TODO</span> Chandy &amp; Lamport Algorithm at Global States</h3>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> <span class="todo TODO">TODO</span> Data-Centric Consistency Models &amp; Protocols</h3>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> <span class="todo TODO">TODO</span> Complete document (2 sections left)</h3>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Introduction</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> What is DS?</h3>
<div class="outline-text-3" id="text-2-1">
</div><div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1"><span class="section-number-4">2.1.1</span> Definition</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
A set of networked computers that <span class="underline">communicate</span> and <span class="underline">coordinate</span> their actions only by <span class="underline">passing messages</span>.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Fundamental Characteristics of DS</h3>
<div class="outline-text-3" id="text-2-2">
</div><div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> Concurrency</h4>
<div class="outline-text-4" id="text-2-2-1">
<ul class="org-ul">
<li>More computer &rarr; Higher capacity &rarr; Higher performance
</li>
<li>Need coordination
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2"><span class="section-number-4">2.2.2</span> Loosely coupled</h4>
<div class="outline-text-4" id="text-2-2-2">
<ul class="org-ul">
<li>No global clock
<ul class="org-ul">
<li>difficult sync
</li>
<li>lack certainty
</li>
<li>difficult algo design
</li>
</ul>
</li>
<li>No global shared memory
<ul class="org-ul">
<li>interaction by message passing
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-2-3" class="outline-4">
<h4 id="sec-2-2-3"><span class="section-number-4">2.2.3</span> Independent failures</h4>
<div class="outline-text-4" id="text-2-2-3">
<ul class="org-ul">
<li>difficult detection
</li>
<li>more fault-tolerant if properly designed
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Main Motivation of DS: Resource Sharing</h3>
<div class="outline-text-3" id="text-2-3">
</div><div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1"><span class="section-number-4">2.3.1</span> Description</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
We can share resources (e.g. information, hardware, software) over a DS to save cost and manpower.
</p>

<p>
Resources are shared via <span class="underline">services</span>. Server accepts client requests, performs services, responds to clients. Requests and replies are sent in form of messages.
</p>
</div>
</div>
<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2"><span class="section-number-4">2.3.2</span> Service</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
Distinct part of computer system providing accesses to managed resources
</p>
</div>
</div>
<div id="outline-container-sec-2-3-3" class="outline-4">
<h4 id="sec-2-3-3"><span class="section-number-4">2.3.3</span> Server</h4>
<div class="outline-text-4" id="text-2-3-3">
<p>
Process managing resources
</p>
</div>
</div>
<div id="outline-container-sec-2-3-4" class="outline-4">
<h4 id="sec-2-3-4"><span class="section-number-4">2.3.4</span> Client</h4>
<div class="outline-text-4" id="text-2-3-4">
<p>
Process requesting resources access 
</p>
</div>
</div>
<div id="outline-container-sec-2-3-5" class="outline-4">
<h4 id="sec-2-3-5"><span class="section-number-4">2.3.5</span> Remote Invocation</h4>
<div class="outline-text-4" id="text-2-3-5">
<p>
a complete interaction between client &amp; server. (request to response).
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> DS Issues and Problems</h3>
<div class="outline-text-3" id="text-2-4">
</div><div id="outline-container-sec-2-4-1" class="outline-4">
<h4 id="sec-2-4-1"><span class="section-number-4">2.4.1</span> Heterogeneity</h4>
<div class="outline-text-4" id="text-2-4-1">
</div><ol class="org-ol"><li><a id="sec-2-4-1-1" name="sec-2-4-1-1"></a>Networks<br  /></li>
<li><a id="sec-2-4-1-2" name="sec-2-4-1-2"></a>Hardware<br  /></li>
<li><a id="sec-2-4-1-3" name="sec-2-4-1-3"></a>OS<br  /></li>
<li><a id="sec-2-4-1-4" name="sec-2-4-1-4"></a>Programming languages<br  /></li></ol>
</div>
<div id="outline-container-sec-2-4-2" class="outline-4">
<h4 id="sec-2-4-2"><span class="section-number-4">2.4.2</span> Scalability</h4>
<div class="outline-text-4" id="text-2-4-2">
</div><ol class="org-ol"><li><a id="sec-2-4-2-1" name="sec-2-4-2-1"></a>Approaches to handle increasing demand<br  /><div class="outline-text-5" id="text-2-4-2-1">
<ul class="org-ul">
<li>Caching and data replication
</li>
<li>Deploy multiple servers
</li>
</ul>
</div>
</li>
<li><a id="sec-2-4-2-2" name="sec-2-4-2-2"></a>Avoid bottlenecks<br  /><div class="outline-text-5" id="text-2-4-2-2">
<ul class="org-ul">
<li>Prefer decentralized to centralized
</li>
</ul>
</div>
</li>
<li><a id="sec-2-4-2-3" name="sec-2-4-2-3"></a>Prevent SW resources from running out<br  /><div class="outline-text-5" id="text-2-4-2-3">
<ul class="org-ul">
<li>e.g. IP length
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-2-4-3" class="outline-4">
<h4 id="sec-2-4-3"><span class="section-number-4">2.4.3</span> Failure handling</h4>
<div class="outline-text-4" id="text-2-4-3">
</div><ol class="org-ol"><li><a id="sec-2-4-3-1" name="sec-2-4-3-1"></a>Detecting<br  /><div class="outline-text-5" id="text-2-4-3-1">
<p>
e.g. checksum for corruption
</p>
</div>
</li>
<li><a id="sec-2-4-3-2" name="sec-2-4-3-2"></a>Masking<br  /><div class="outline-text-5" id="text-2-4-3-2">
<p>
e.g. retransmission for losts
</p>
</div>
</li>
<li><a id="sec-2-4-3-3" name="sec-2-4-3-3"></a>Tolerating<br  /><div class="outline-text-5" id="text-2-4-3-3">
<p>
use redundancy
</p>
</div>
</li>
<li><a id="sec-2-4-3-4" name="sec-2-4-3-4"></a>Recovery<br  /><div class="outline-text-5" id="text-2-4-3-4">
<ul class="org-ul">
<li>rollback when crashing
</li>
<li>not leaving data in inconsistent state
</li>
</ul>
</div>
</li></ol>
</div>
</div>
<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> Architectural Models</h3>
<div class="outline-text-3" id="text-2-5">
</div><div id="outline-container-sec-2-5-1" class="outline-4">
<h4 id="sec-2-5-1"><span class="section-number-4">2.5.1</span> SW and HW layers (vertical)</h4>
<div class="outline-text-4" id="text-2-5-1">
</div><ol class="org-ol"><li><a id="sec-2-5-1-1" name="sec-2-5-1-1"></a>Platform<br  /><div class="outline-text-5" id="text-2-5-1-1">
<p>
Bring system's programming interface up to a level that facilitates communication and coordination between processes.
</p>
</div>
<ol class="org-ol"><li><a id="sec-2-5-1-1-1" name="sec-2-5-1-1-1"></a>Hardware<br  /></li>
<li><a id="sec-2-5-1-1-2" name="sec-2-5-1-1-2"></a>OS<br  /></li></ol>
</li>
<li><a id="sec-2-5-1-2" name="sec-2-5-1-2"></a>Middleware<br  /><div class="outline-text-5" id="text-2-5-1-2">
<p>
SW layer to mask heterogeneity and provide convenient programming model.
Provide generic services to applications, e.g.:
</p>
<ul class="org-ul">
<li>Naming
</li>
<li>Security
</li>
<li>Persistent storage
</li>
</ul>
<p>
e.g. Sun RPC, Java RMI, CORBA
</p>
</div>
</li>
<li><a id="sec-2-5-1-3" name="sec-2-5-1-3"></a>Applications/services<br  /></li></ol>
</div>
<div id="outline-container-sec-2-5-2" class="outline-4">
<h4 id="sec-2-5-2"><span class="section-number-4">2.5.2</span> System architectures (horizontal)</h4>
<div class="outline-text-4" id="text-2-5-2">
</div><ol class="org-ol"><li><a id="sec-2-5-2-1" name="sec-2-5-2-1"></a>Client-server<br  /><div class="outline-text-5" id="text-2-5-2-1">
<p>
Simple yet useful. Division of work among servers: partitioning and replication.
</p>
</div>
<ol class="org-ol"><li><a id="sec-2-5-2-1-1" name="sec-2-5-2-1-1"></a>Server<br  /><div class="outline-text-6" id="text-2-5-2-1-1">
<p>
Processes that manage resources
</p>
</div>
</li>
<li><a id="sec-2-5-2-1-2" name="sec-2-5-2-1-2"></a>Client<br  /><div class="outline-text-6" id="text-2-5-2-1-2">
<p>
Processes that use/access service
</p>
</div>
</li></ol>
</li>
<li><a id="sec-2-5-2-2" name="sec-2-5-2-2"></a>P2P<br  /><div class="outline-text-5" id="text-2-5-2-2">
<ul class="org-ul">
<li>All processes play similar roles
</li>
<li>No distinction of roles
</li>
<li>More complex
</li>
</ul>
</div>
</li></ol>
</div>
</div>
<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> Fundamental Models</h3>
<div class="outline-text-3" id="text-2-6">
<p>
More formal description of common and intrinsic properties
</p>
</div>
<div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1"><span class="section-number-4">2.6.1</span> Interaction Model</h4>
<div class="outline-text-4" id="text-2-6-1">
</div><ol class="org-ol"><li><a id="sec-2-6-1-1" name="sec-2-6-1-1"></a>Synchronous DS<br  /><div class="outline-text-5" id="text-2-6-1-1">
<ul class="org-ul">
<li>Bounds on
<ul class="org-ul">
<li>Processing time
</li>
<li>Transmission time
</li>
<li>Clock drift rate
</li>
</ul>
</li>
<li>Infer properties
<ul class="org-ul">
<li>Timeout to detect failures
</li>
<li>Bound lag
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-2-6-1-2" name="sec-2-6-1-2"></a>Asynchronous DS<br  /><div class="outline-text-5" id="text-2-6-1-2">
<ul class="org-ul">
<li>No bounds
</li>
<li>Model internet
</li>
<li>Can't use timeouts to detect failures
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-2-6-2" class="outline-4">
<h4 id="sec-2-6-2"><span class="section-number-4">2.6.2</span> Failure Model</h4>
<div class="outline-text-4" id="text-2-6-2">
</div><ol class="org-ol"><li><a id="sec-2-6-2-1" name="sec-2-6-2-1"></a>Omission failure<br  /><ol class="org-ol"><li><a id="sec-2-6-2-1-1" name="sec-2-6-2-1-1"></a>Process<br  /><div class="outline-text-6" id="text-2-6-2-1-1">
<p>
Crash
</p>
</div>
</li>
<li><a id="sec-2-6-2-1-2" name="sec-2-6-2-1-2"></a>Communication<br  /><div class="outline-text-6" id="text-2-6-2-1-2">
<p>
Fail to deliver
</p>
</div>
</li></ol>
</li>
<li><a id="sec-2-6-2-2" name="sec-2-6-2-2"></a>Byzantine failure<br  /><div class="outline-text-5" id="text-2-6-2-2">
<ul class="org-ul">
<li>cause trouble
</li>
<li>arbitrarily omit intended steps
</li>
<li>arbitrarily take unintended steps
</li>
<li>process
<ul class="org-ul">
<li>set wrong values
</li>
<li>return wrong result
</li>
</ul>
</li>
<li>communication
<ul class="org-ul">
<li>corruption
</li>
<li>more than once
</li>
</ul>
</li>
</ul>
</div>
</li></ol>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Interprocess Communication</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> External Data Representation &amp; Mashalling</h3>
<div class="outline-text-3" id="text-3-1">
</div><div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> Marshal &amp; Unmarshal</h4>
<div class="outline-text-4" id="text-3-1-1">
<ul class="org-ul">
<li>data transmitted as sequence of bytes
</li>
<li>data structures must be flattened
</li>
<li>different representations of same datatype
<ul class="org-ul">
<li>big endian: MSB first
</li>
<li>little endian: LSB first
</li>
</ul>
</li>
<li>extrenal data representation
<ul class="org-ul">
<li>agreed standard for representation
</li>
</ul>
</li>
<li>interprocess communication
<ul class="org-ul">
<li>define standard
</li>
<li>marshalling
<ul class="org-ul">
<li>structured &amp; primitive &rarr; external data representation
</li>
</ul>
</li>
<li>unmarshalling
<ul class="org-ul">
<li>external data representation &rarr; structured &amp; primitive
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> CORBA's Common Data Representation</h4>
<div class="outline-text-4" id="text-3-1-2">
<ul class="org-ul">
<li>can represent all primitive and constructed datatypes
</li>
<li>types of data items are not given
</li>
<li>it is assumed that sender and recipient have common knowledge of order and types of data items
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-1-3" class="outline-4">
<h4 id="sec-3-1-3"><span class="section-number-4">3.1.3</span> Java object serialization</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
Deserialization does not require prior knowledge of object types.
</p>

<div class="org-src-container">

<pre class="src src-java">class Person implements Serializable{
  private String name;
  private String place;
  private int year;
}
</pre>
</div>

<p>
Person {"Smith","London",1934} will be serialized as:
</p>
<ul class="org-ul">
<li>Person
</li>
<li>Version number (8 bytes)
</li>
<li>h0 (class handle)
</li>
<li>3 (# of fields)
</li>
<li>int year
</li>
<li>java.lang.String name
</li>
<li>java.lang.String place
</li>
<li>1934
</li>
<li>5 Smith
</li>
<li>6 London
</li>
<li>h1 (object handle)
</li>
</ul>

<div class="org-src-container">

<pre class="src src-java">class Person implements Serializable{
  private Person one;
  private Person two;
  public Couple(Person a, Person b){
    one = a;
    two = b;
  }
}
</pre>
</div>

<p>
Couple { {"Smith","London",1934} , {"Jones","Paris",1945} } will be serialized as:
</p>
<ul class="org-ul">
<li>Couple
</li>
<li>8 byte version number
</li>
<li>h0
</li>
<li>2
</li>
<li>Person one
</li>
<li>Person two
</li>
<li>Person
</li>
<li>8 byte version number
</li>
<li>h1
</li>
<li>3
</li>
<li>int year
</li>
<li>java.lang.String name
</li>
<li>java.lang.String place
</li>
<li>1934
</li>
<li>5 Smith
</li>
<li>6 London
</li>
<li>h2
</li>
<li>1945
</li>
<li>5 Jones
</li>
<li>5 Paris
</li>
<li>h3
</li>
<li>h4
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Client-Server Communication</h3>
<div class="outline-text-3" id="text-3-2">
</div><div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1"><span class="section-number-4">3.2.1</span> Reliability</h4>
<div class="outline-text-4" id="text-3-2-1">
</div><ol class="org-ol"><li><a id="sec-3-2-1-1" name="sec-3-2-1-1"></a>Validity<br  /><div class="outline-text-5" id="text-3-2-1-1">
<p>
Message reaches destination
</p>
</div>
</li>
<li><a id="sec-3-2-1-2" name="sec-3-2-1-2"></a>Integrity<br  /><div class="outline-text-5" id="text-3-2-1-2">
<ul class="org-ul">
<li>Message received = message sent
</li>
<li>Received only once
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2"><span class="section-number-4">3.2.2</span> UDP</h4>
<div class="outline-text-4" id="text-3-2-2">
</div><ol class="org-ol"><li><a id="sec-3-2-2-1" name="sec-3-2-2-1"></a>Features<br  /><div class="outline-text-5" id="text-3-2-2-1">
<ul class="org-ul">
<li>no ack or retries
</li>
<li>fragmentation for message larger than max
</li>
<li>not reliable
<ul class="org-ul">
<li>integrity
<ul class="org-ul">
<li>checksum
</li>
</ul>
</li>
<li>no validity
<ul class="org-ul">
<li>communication omission failure
</li>
</ul>
</li>
</ul>
</li>
<li>for quick response, can assume reliability, manual fault handling
</li>
</ul>
</div>
</li>
<li><a id="sec-3-2-2-2" name="sec-3-2-2-2"></a>Goal<br  /><div class="outline-text-5" id="text-3-2-2-2">
<p>
To build reliable protocol over UDP:
</p>
<ul class="org-ul">
<li>use timeout
<ul class="org-ul">
<li>solve lost request problem
</li>
<li>but lost reply may imply more than once execution if operation is non-idempotent
</li>
</ul>
</li>
<li>use requestID to filter out duplicates
</li>
</ul>
</div>
</li></ol>
</div>

<div id="outline-container-sec-3-2-3" class="outline-4">
<h4 id="sec-3-2-3"><span class="section-number-4">3.2.3</span> TCP</h4>
<div class="outline-text-4" id="text-3-2-3">
</div><ol class="org-ol"><li><a id="sec-3-2-3-1" name="sec-3-2-3-1"></a>Features<br  /><div class="outline-text-5" id="text-3-2-3-1">
<ul class="org-ul">
<li>abstraction of reliable stream
<ul class="org-ul">
<li>connection-oriented
<ul class="org-ul">
<li>setup connection before data transfer
</li>
</ul>
</li>
<li>ack and retries
</li>
<li>tranparent message size segmentation
</li>
</ul>
</li>
<li>reliable
<ul class="org-ul">
<li>integrity
<ul class="org-ul">
<li>checksum
</li>
<li>sequence number
</li>
</ul>
</li>
<li>validity
<ul class="org-ul">
<li>ack
</li>
<li>timeouts
</li>
</ul>
</li>
</ul>
</li>
<li>overhead
<ul class="org-ul">
<li>store state info
</li>
<li>transmission overhead
</li>
<li>latency from connection setup
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-3-2-3-2" name="sec-3-2-3-2"></a>Goal<br  /><div class="outline-text-5" id="text-3-2-3-2">
<p>
To reduce of overhead of protocols over TCP:
</p>
<ul class="org-ul">
<li>send requests and replies over same connection
<ul class="org-ul">
<li>avoid multiple TCP slow-starts
</li>
<li>amortize connection establishment overhad
</li>
</ul>
</li>
</ul>
</div>
</li></ol>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Distributed Objects &amp; Remote Invocation</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Object Model</h3>
<div class="outline-text-3" id="text-4-1">
<p>
consists of a collection of interacting objects
</p>
<ul class="org-ul">
<li>communicate by invoking methods
</li>
<li>to invoke a method, need&#x2026;
<ul class="org-ul">
<li>object reference
</li>
<li>method name
</li>
<li>arguments
</li>
</ul>
</li>
<li>interface defines method signatures
<ul class="org-ul">
<li>definitions only
</li>
<li>no implementation
</li>
<li>implementation can be changed without changing interface
</li>
</ul>
</li>
<li>exceptions:
<ul class="org-ul">
<li>errors
</li>
<li>unexpected conditions
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Distributed Object Model</h3>
<div class="outline-text-3" id="text-4-2">
</div><div id="outline-container-sec-4-2-1" class="outline-4">
<h4 id="sec-4-2-1"><span class="section-number-4">4.2.1</span> Description</h4>
<div class="outline-text-4" id="text-4-2-1">
<ul class="org-ul">
<li>servers manage objects, clients invoke methods w/ RMI
</li>
<li>remote method invocation
<ul class="org-ul">
<li>between objects in different processes
</li>
</ul>
</li>
<li>local method invocation
<ul class="org-ul">
<li>between objects in same process
</li>
</ul>
</li>
<li>remote objects
<ul class="org-ul">
<li>objects that can receive remote invocations
</li>
</ul>
</li>
<li>to invoke a method, need
<ul class="org-ul">
<li>remote object reference
<ul class="org-ul">
<li>created by server
</li>
<li>obtained by client to access object
</li>
</ul>
</li>
<li>method name
</li>
<li>arguments
</li>
</ul>
</li>
<li>remote interface
<ul class="org-ul">
<li>specifies methods that can be invoked remotely
</li>
<li>defined by
<ul class="org-ul">
<li>Java interface
</li>
<li>CORBA Interface Definition Language (IDL)
</li>
</ul>
</li>
</ul>
</li>
<li>exception raised by RMI due to
<ul class="org-ul">
<li>distribution
<ul class="org-ul">
<li>timeouts
</li>
<li>lost messages
</li>
</ul>
</li>
<li>method exceptions
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-2-2" class="outline-4">
<h4 id="sec-4-2-2"><span class="section-number-4">4.2.2</span> Invocation Semantics</h4>
<div class="outline-text-4" id="text-4-2-2">
</div><ol class="org-ol"><li><a id="sec-4-2-2-1" name="sec-4-2-2-1"></a>Maybe<br  /><div class="outline-text-5" id="text-4-2-2-1">
<ul class="org-ul">
<li>No retransmission
</li>
<li>If result, server executed method.
</li>
<li>If no result,
<ul class="org-ul">
<li>communication omission failure
<ul class="org-ul">
<li>request lost
<ul class="org-ul">
<li>not executed
</li>
</ul>
</li>
<li>reply lost
<ul class="org-ul">
<li>executed
</li>
</ul>
</li>
</ul>
</li>
<li>process omission failure
<ul class="org-ul">
<li>executed/not executed
</li>
</ul>
</li>
</ul>
</li>
<li>e.g. CORBA for void methods
</li>
</ul>
</div>
</li>
<li><a id="sec-4-2-2-2" name="sec-4-2-2-2"></a>At-least-once<br  /><div class="outline-text-5" id="text-4-2-2-2">
<ul class="org-ul">
<li>Retransmission
</li>
<li>If result, server executed method &ge;1x
</li>
<li>If no result, ??
</li>
<li>Acceptable if idempotent
</li>
<li>e.g. Sun RPC
</li>
</ul>
</div>
</li>
<li><a id="sec-4-2-2-3" name="sec-4-2-2-3"></a>At-most-once<br  /><div class="outline-text-5" id="text-4-2-2-3">
<ul class="org-ul">
<li>Retransmission and duplicate-filtering
</li>
<li>If result, server executed method 1x
</li>
<li>If no result, &le;1x
</li>
<li>e.g. Java RMI and CORBA
</li>
</ul>
</div>
</li></ol>
</div>
</div>
<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Architecture of RMI</h3>
<div class="outline-text-3" id="text-4-3">
</div><div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> Proxy</h4>
<div class="outline-text-4" id="text-4-3-1">
<ul class="org-ul">
<li>1 proxy foreach class of remote object reference
</li>
<li>proxy implements methods in remote interface
<ul class="org-ul">
<li>transparency of RMI
</li>
</ul>
</li>
<li>marshals arguments and unmarshals results
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2"><span class="section-number-4">4.3.2</span> Communication Modules</h4>
<div class="outline-text-4" id="text-4-3-2">
<ul class="org-ul">
<li>transmit request/reply
</li>
<li>e.g. messageType + requestID + remoteObjectReference + methodID + arguments
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-3" class="outline-4">
<h4 id="sec-4-3-3"><span class="section-number-4">4.3.3</span> Skeleton</h4>
<div class="outline-text-4" id="text-4-3-3">
<ul class="org-ul">
<li>1 skeleton foreach class of remote object
</li>
<li>implements methods in remote interface
</li>
<li>unmarshals arguments, invokes method, marshals results
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-4" class="outline-4">
<h4 id="sec-4-3-4"><span class="section-number-4">4.3.4</span> Binder</h4>
<div class="outline-text-4" id="text-4-3-4">
<ul class="org-ul">
<li>name service that maintains mappings
<ul class="org-ul">
<li>object name &rarr; remote object references
</li>
</ul>
</li>
<li>server register remote objects by name in binders
</li>
<li>clients look up references
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3-5" class="outline-4">
<h4 id="sec-4-3-5"><span class="section-number-4">4.3.5</span> Description</h4>
<div class="outline-text-4" id="text-4-3-5">
<ul class="org-ul">
<li>proxy and skeleton automatically generated by interface compiler
<ul class="org-ul">
<li>Java &rarr; Java RMI compiler
</li>
<li>CORBA &rarr; use interface compiler
</li>
</ul>
</li>
<li>server
<ul class="org-ul">
<li>skeleton
</li>
<li>real implementation of methods
</li>
</ul>
</li>
<li>client
<ul class="org-ul">
<li>proxy
</li>
</ul>
</li>
</ul>

<p>
For client to obtain RMI,
</p>
<ul class="org-ul">
<li>remote object references may not be available at programming
</li>
<li>object names in text form are more convenient
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> Java RMI Example</h3>
<div class="outline-text-3" id="text-4-4">
</div><div id="outline-container-sec-4-4-1" class="outline-4">
<h4 id="sec-4-4-1"><span class="section-number-4">4.4.1</span> Polling</h4>
<div class="outline-text-4" id="text-4-4-1">
</div><ol class="org-ol"><li><a id="sec-4-4-1-1" name="sec-4-4-1-1"></a>Architecture<br  /><ol class="org-ol"><li><a id="sec-4-4-1-1-1" name="sec-4-4-1-1-1"></a>Servant<br  /><div class="outline-text-6" id="text-4-4-1-1-1">
<p>
Implement methods in remote interface
</p>
</div>
</li>
<li><a id="sec-4-4-1-1-2" name="sec-4-4-1-1-2"></a>Server<br  /><div class="outline-text-6" id="text-4-4-1-1-2">
<ul class="org-ul">
<li>create remote objects
</li>
<li>register them in RMIregistry
</li>
</ul>
</div>
</li>
<li><a id="sec-4-4-1-1-3" name="sec-4-4-1-1-3"></a>Client<br  /><div class="outline-text-6" id="text-4-4-1-1-3">
<p>
Lookup remote objects and access them
</p>
</div>
</li></ol>
</li>
<li><a id="sec-4-4-1-2" name="sec-4-4-1-2"></a>RMI registry<br  /><div class="outline-text-5" id="text-4-4-1-2">
<p>
Binder for Java RMI
</p>
<ul class="org-ul">
<li>map URL-style names &rarr; remote object reference
</li>
<li>an instance of RMIregistry must run on each server
</li>
<li>two cases:
<ul class="org-ul">
<li>shared by all servers of different remote objects on same host (port 1099)
</li>
<li>1 registry per server, each different port
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-4-4-1-3" name="sec-4-4-1-3"></a>Implementation<br  /><ol class="org-ol"><li><a id="sec-4-4-1-3-1" name="sec-4-4-1-3-1"></a>How to compile<br  /><div class="outline-text-6" id="text-4-4-1-3-1">
<ol class="org-ol">
<li>Compile remote interface
<ul class="org-ul">
<li>generate proxies
</li>
<li>generate skeletons
</li>
</ul>
</li>
<li>Compile source codes
</li>
<li>Start server
</li>
<li>Start client
</li>
</ol>
</div>
</li>
<li><a id="sec-4-4-1-3-2" name="sec-4-4-1-3-2"></a>Example 1<br  /><div class="outline-text-6" id="text-4-4-1-3-2">
<ul class="org-ul">
<li>Remote interface
</li>
</ul>
<div class="org-src-container">

<pre class="src src-java">import java.rmi.*;

public interface City extends Remote{
  int getPopulation(String x) throws RemoteException;
}
</pre>
</div>

<ul class="org-ul">
<li>Servant class
</li>
</ul>
<div class="org-src-container">

<pre class="src src-java">import java.rmi.*;
import java.rmi.server.*;

public class CityImpl extends UnicastRemoteObject implements City{
  public CityImpl throws RemoteException{
    super();
  }
  public int getPopulation(String x) throws RemoteException{

  }
}
</pre>
</div>
<ul class="org-ul">
<li>Server class
</li>
</ul>
<div class="org-src-container">

<pre class="src src-java">import java.rmi.*;
import java.rmi.server.*;

public class CityServer{
  public static void main(String args[]){
    try{
      CityImpl ci = new CityImpl();
      Naming.rebind("rmi://.../City",ci);
    }catch(Exception e){}
  }
}
</pre>
</div>

<ul class="org-ul">
<li>Client class
</li>
</ul>
<div class="org-src-container">

<pre class="src src-java">import java.rmi.*;

public class CityClient{
  public static void main(String args[]){
    try{
      City c = (City) Naming.lookup("rmi://.../City");
      c.getPopulation("Toronto");
    }
    catch (RemoteException e){}
    catch (Exception e){}
  }
}
</pre>
</div>
</div>
</li></ol>
</li></ol>
</div>

<div id="outline-container-sec-4-4-2" class="outline-4">
<h4 id="sec-4-4-2"><span class="section-number-4">4.4.2</span> Callback</h4>
<div class="outline-text-4" id="text-4-4-2">
<p>
Server informs when updated.
How to implement?
</p>
<ul class="org-ul">
<li>client creates callback remote object
</li>
</ul>
<div class="org-src-container">

<pre class="src src-java">public interface Callback extends Remote{
  void cbMethod() throws RemoteException;
}
</pre>
</div>
<ul class="org-ul">
<li>server provides <code>register(Callback cb)</code> and <code>deregister(Callback cb)</code>
</li>
</ul>
<div class="org-src-container">

<pre class="src src-java">void register(Callback cbObject) throws RemoteException;
void deregister(Callback cbObject) throws RemoteException;
</pre>
</div>
<ul class="org-ul">
<li>when event occurs, server invokes method in <code>Callback</code>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Distributed File Systems</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Introduction</h3>
<div class="outline-text-3" id="text-5-1">
</div><div id="outline-container-sec-5-1-1" class="outline-4">
<h4 id="sec-5-1-1"><span class="section-number-4">5.1.1</span> File System</h4>
<div class="outline-text-4" id="text-5-1-1">
<ul class="org-ul">
<li>allow multiple clients to share access to files
</li>
<li>provides API to programmers
</li>
</ul>

<p>
Elements:
</p>
<ul class="org-ul">
<li>files
<ul class="org-ul">
<li>contain data and attributes
</li>
</ul>
</li>
<li>directories
<ul class="org-ul">
<li>special types of files
</li>
<li>mapping: text names &rarr; internal file identifiers
</li>
<li>serve as folders of files
</li>
<li>form hierarchical structure
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-1-2" class="outline-4">
<h4 id="sec-5-1-2"><span class="section-number-4">5.1.2</span> Distributed File System</h4>
<div class="outline-text-4" id="text-5-1-2">
</div><ol class="org-ol"><li><a id="sec-5-1-2-1" name="sec-5-1-2-1"></a>Features<br  /><div class="outline-text-5" id="text-5-1-2-1">
<ul class="org-ul">
<li>support file accesses throughout an intranet
</li>
<li>new features
<ul class="org-ul">
<li>distributed naming and location
</li>
<li>component to deal with client-server communication
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-1-2-2" name="sec-5-1-2-2"></a>Requirements<br  /><ol class="org-ol"><li><a id="sec-5-1-2-2-1" name="sec-5-1-2-2-1"></a>Transparency<br  /><div class="outline-text-6" id="text-5-1-2-2-1">
<ul class="org-ul">
<li>access
<ul class="org-ul">
<li>same interface for accesses to local &amp; remote files
</li>
</ul>
</li>
<li>location
<ul class="org-ul">
<li>uniform file name space
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-1-2-2-2" name="sec-5-1-2-2-2"></a>File replication &amp; consistency maintenance<br  /><div class="outline-text-6" id="text-5-1-2-2-2">
<ul class="org-ul">
<li>to improve performance and enhance scalability
</li>
<li>enhance fault tolerance
</li>
<li>thus need to maintain consistency
</li>
</ul>
</div>
</li>
<li><a id="sec-5-1-2-2-3" name="sec-5-1-2-2-3"></a>Fault tolerance<br  /><ol class="org-ol"><li><a id="sec-5-1-2-2-3-1" name="sec-5-1-2-2-3-1"></a>Stateful<br  /><div class="outline-text-7" id="text-5-1-2-2-3-1">
<ul class="org-ul">
<li>remembers client's previous operations
</li>
<li>inter-dependent requests
</li>
<li>heavier server demand
</li>
<li>difficult setup and recovery on crashes
<ul class="org-ul">
<li>server must restore/notify after restart
</li>
<li>server must detect client crashes and discard states
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-1-2-2-3-2" name="sec-5-1-2-2-3-2"></a>Stateless<br  /><div class="outline-text-7" id="text-5-1-2-2-3-2">
<ul class="org-ul">
<li>untracked independent self-contained requests
</li>
<li>easy setup and restore
</li>
<li>less burden
</li>
<li>heavier network demand
</li>
</ul>
</div>
</li></ol>
</li></ol>
</li></ol>
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Sun NFS</h3>
<div class="outline-text-3" id="text-5-2">
</div><div id="outline-container-sec-5-2-1" class="outline-4">
<h4 id="sec-5-2-1"><span class="section-number-4">5.2.1</span> Overview</h4>
<div class="outline-text-4" id="text-5-2-1">
<ul class="org-ul">
<li>access transparency
<ul class="org-ul">
<li>apps use same file operations for both local &amp; remote
</li>
</ul>
</li>
<li>no location tranparency
<ul class="org-ul">
<li>different clients can mount server dir to different local dirs
</li>
</ul>
</li>
<li>stateless servers and idempotent operations
<ul class="org-ul">
<li>no need to recover state
</li>
<li>server unaffected by client failure
</li>
</ul>
</li>
<li>approximate one-copy update semantics
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-2-2" class="outline-4">
<h4 id="sec-5-2-2"><span class="section-number-4">5.2.2</span> Architecture</h4>
<div class="outline-text-4" id="text-5-2-2">
<ul class="org-ul">
<li>symmetric client-server relationship
<ul class="org-ul">
<li>each computer in network can act both as client/server
</li>
</ul>
</li>
<li>OS independent design
</li>
<li>files are accessed by means of file IDs
<ul class="org-ul">
<li>file IDs is reference to file in the FS
</li>
<li>file IDs are called file handles in NFS
<ul class="org-ul">
<li>FS ID
</li>
<li>ID for file in FS
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-2-3" class="outline-4">
<h4 id="sec-5-2-3"><span class="section-number-4">5.2.3</span> Client-Server Communication</h4>
<div class="outline-text-4" id="text-5-2-3">
</div><ol class="org-ol"><li><a id="sec-5-2-3-1" name="sec-5-2-3-1"></a>NFS Server Interface<br  /><div class="outline-text-5" id="text-5-2-3-1">
<ul class="org-ul">
<li>operations used by NFS client in RPC
</li>
<li>not used directly by user programs
</li>
<li>stateles and idempotent operations
<ul class="org-ul">
<li>no open close and RW pointer
</li>
<li>self contained
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-2-3-2" name="sec-5-2-3-2"></a>NFS Client<br  /><div class="outline-text-5" id="text-5-2-3-2">
<ul class="org-ul">
<li>supply interface suitable for use by conventional programs
<ul class="org-ul">
<li>emulates UNIX FS emantics
</li>
</ul>
</li>
<li>transfer blocks of files to/from NFS servers
</li>
</ul>
</div>
</li>
<li><a id="sec-5-2-3-3" name="sec-5-2-3-3"></a>Mount Service<br  /><ol class="org-ol"><li><a id="sec-5-2-3-3-1" name="sec-5-2-3-3-1"></a>Overview<br  /><div class="outline-text-6" id="text-5-2-3-3-1">
<ul class="org-ul">
<li>server exports FS
<ul class="org-ul">
<li>mount service process runs
</li>
<li><code>/etc/exports</code>:
<ul class="org-ul">
<li>names of local FS available for remote mounting
</li>
<li>hosts permitted to mount
</li>
</ul>
</li>
</ul>
</li>
<li>client mounts FS
<ul class="org-ul">
<li>use modified UNIX mount to request mounting
<ul class="org-ul">
<li>remote host name
</li>
<li>pathname in remote FS
</li>
<li>local name
</li>
</ul>
</li>
<li>communicates with mount service using RPC protocol
<ul class="org-ul">
<li>request: remote dir pathname to server
</li>
<li>reply: file handle of dir
</li>
</ul>
</li>
<li>maintains table of mounted FS
</li>
<li>NFS doesn't enforce single network-wide file namespace
<ul class="org-ul">
<li>can assign different local names to remote directory
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-2-3-3-2" name="sec-5-2-3-3-2"></a>Pathname Translation<br  /><div class="outline-text-6" id="text-5-2-3-3-2">
<p>
Suppose <code>/</code> of remote server is mounted. To access <code>/bin/draw/readme</code>:
</p>
<ol class="org-ol">
<li><code>binfh = lookup(rootfh,"bin")</code>
</li>
<li><code>drawfh = lookup(binfh,"draw")</code>
</li>
<li><code>readmefh = lookup(drawfh,"readme")</code>
</li>
</ol>
<p>
Efficiency can be improved by caching.
</p>
</div>
</li></ol>
</li></ol>
</div>
<div id="outline-container-sec-5-2-4" class="outline-4">
<h4 id="sec-5-2-4"><span class="section-number-4">5.2.4</span> Client Caching</h4>
<div class="outline-text-4" id="text-5-2-4">
<ul class="org-ul">
<li>caches results of RW etc
<ul class="org-ul">
<li>to reduce communication with server
</li>
<li>block granularity
</li>
<li>mainly in main memory
</li>
</ul>
</li>
<li>comparison
<ul class="org-ul">
<li>local systems
<ul class="org-ul">
<li>one-copy update semantics
<ul class="org-ul">
<li>when file modified, all other clients see updates immediately
</li>
</ul>
</li>
</ul>
</li>
<li>distributed systems
<ul class="org-ul">
<li>approximation to one-copy update semantics
</li>
</ul>
</li>
</ul>
</li>
<li>writes by client do not result in immediate updating of cached copies of same file in other clients
</li>
<li>potentially different versions of files across different clients
</li>
<li>to maintain consistency, clients should poll server
</li>
<li>cache is fresh when <code>T-Tc &lt; t</code>
</li>
<li>otherwise, need to poll validity
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> AFS and Code File Systems</h3>
<div class="outline-text-3" id="text-5-3">
</div><div id="outline-container-sec-5-3-1" class="outline-4">
<h4 id="sec-5-3-1"><span class="section-number-4">5.3.1</span> Overview</h4>
<div class="outline-text-4" id="text-5-3-1">
<ul class="org-ul">
<li>access transparency
</li>
<li>high location transparency
</li>
<li>stateful
</li>
<li>relaxed consistency through session update semantics
</li>
<li>scalable
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-3-2" class="outline-4">
<h4 id="sec-5-3-2"><span class="section-number-4">5.3.2</span> AFS Architecture</h4>
<div class="outline-text-4" id="text-5-3-2">
</div><ol class="org-ol"><li><a id="sec-5-3-2-1" name="sec-5-3-2-1"></a>Features<br  /><div class="outline-text-5" id="text-5-3-2-1">
<ul class="org-ul">
<li>scalable
</li>
<li>two partitions of nodes
<ul class="org-ul">
<li>dedicated file servers
</li>
<li>large number of clients
</li>
</ul>
</li>
<li>similar to NFS
<ul class="org-ul">
<li>access to files via normal UNIX operations
</li>
<li>venus clients and vice servers communicate using RPC
</li>
<li>user programs use conventional UNIX pathnames to refer to files
</li>
<li>venus translates pathnames into file IDs using step-by-step lookups from dirs in vice servers
</li>
<li>files accesses by the obtained file IDs
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-3-2-2" name="sec-5-3-2-2"></a>Shared File Namespace<br  /><div class="outline-text-5" id="text-5-3-2-2">
<ul class="org-ul">
<li>shared file namespace
<ul class="org-ul">
<li>vice servers maintain global shared file namespace
</li>
<li>venus clients follow
</li>
</ul>
</li>
<li>clients have access to shared namespace by special local subdir e.g. /afs
<ul class="org-ul">
<li>client access file in <i>afs</i> &rarr; venus ensures appropriate part mounted
</li>
<li>when mounting, venus ensures naming graph rooted at this subdir is always subgraph of complete shared namespace maintained by vice servers
</li>
<li>shared files have same pathname
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-3-2-3" name="sec-5-3-2-3"></a>Volume<br  /><div class="outline-text-5" id="text-5-3-2-3">
<ul class="org-ul">
<li>easy replication, location, movement
<ul class="org-ul">
<li>basic unit of mounting and replication
</li>
<li>smaller than UNIX FS
</li>
<li>volume = partial subtree in shared namespace maintain by vice servers
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-3-2-4" name="sec-5-3-2-4"></a>Replication<br  /><div class="outline-text-5" id="text-5-3-2-4">
<ul class="org-ul">
<li>each file is contained in =1 logical volume
</li>
<li>volume may be replicated
</li>
<li>each logical volume is associated with a RVID
<ul class="org-ul">
<li>location and replication independent
</li>
</ul>
</li>
<li>each physical volume has own VID
<ul class="org-ul">
<li>location dependent
</li>
</ul>
</li>
<li>each shared file is identified by file ID
<ul class="org-ul">
<li>RVID + file handle
</li>
</ul>
</li>
<li>consistency
<ul class="org-ul">
<li>read-one, write-all
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-3-2-5" name="sec-5-3-2-5"></a>Location<br  /><div class="outline-text-5" id="text-5-3-2-5">
<ul class="org-ul">
<li>Volume replication DB
<ul class="org-ul">
<li>RVID &rarr; VIDs
</li>
</ul>
</li>
<li>Volume location DB
<ul class="org-ul">
<li>VID &rarr; server
</li>
</ul>
</li>
</ul>
<p>
So the file ID is transformed from RVID + file handle to Server + file handle after being passed to Volume replication DB and Volume location DB. Databases are fully replicated at each server.
</p>
</div>
</li></ol>
</div>
<div id="outline-container-sec-5-3-3" class="outline-4">
<h4 id="sec-5-3-3"><span class="section-number-4">5.3.3</span> Whole-File Serving and Caching</h4>
<div class="outline-text-4" id="text-5-3-3">
</div><ol class="org-ol"><li><a id="sec-5-3-3-1" name="sec-5-3-3-1"></a>Typical UNIX Workloads<br  /><div class="outline-text-5" id="text-5-3-3-1">
<ul class="org-ul">
<li>Read more than write
</li>
<li>Entire, sequential file access
</li>
<li>Most files accessed only by one user
</li>
<li>Files are referenced in bursts (temporal locality)
</li>
</ul>
</div>
</li>

<li><a id="sec-5-3-3-2" name="sec-5-3-3-2"></a>Strategy<br  /><div class="outline-text-5" id="text-5-3-3-2">
<ul class="org-ul">
<li>Whole-file serving
<ul class="org-ul">
<li>entire files transmitted to clients
</li>
</ul>
</li>
<li>Whole-file caching
<ul class="org-ul">
<li>transferred files are stored in cache
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-3-3-3" name="sec-5-3-3-3"></a>How it works<br  /><div class="outline-text-5" id="text-5-3-3-3">
<ul class="org-ul">
<li>Open &rarr; entire file transmitted to client
</li>
<li>RWs performed on local copy
</li>
<li>Close &rarr; client transmits updates to server, retain copy
</li>
</ul>
</div>
</li>
<li><a id="sec-5-3-3-4" name="sec-5-3-3-4"></a>Session update semantics<br  /><div class="outline-text-5" id="text-5-3-3-4">
<p>
We relax the one-copy update semantics to reduce network traffic, performance degradation, be more scalable.
</p>

<p>
In session update semantics, all other clients are able to see a modified file only after the file is closed by the client that modified it.
</p>
</div>
</li>
<li><a id="sec-5-3-3-5" name="sec-5-3-3-5"></a>Cache Consistency<br  /><ol class="org-ol"><li><a id="sec-5-3-3-5-1" name="sec-5-3-3-5-1"></a>Method<br  /><div class="outline-text-6" id="text-5-3-3-5-1">
<ul class="org-ul">
<li>foreach file, 
<ul class="org-ul">
<li>server keeps track which clients have copy of it
</li>
<li>notify clients when file modified
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-3-3-5-2" name="sec-5-3-3-5-2"></a>Callback mechanism<br  /><div class="outline-text-6" id="text-5-3-3-5-2">
<ul class="org-ul">
<li>callback promise
<ul class="org-ul">
<li>valid: cache is fresh
</li>
<li>cancelled: cache is out-of-date
</li>
</ul>
</li>
<li>opening file
<ul class="org-ul">
<li>if not cached, fetch file and promise
</li>
<li>if cached and valid, open local copy
</li>
<li>if cached and cancelled, fetch copy and update promise
</li>
</ul>
</li>
<li>closing file
<ul class="org-ul">
<li>if modified, send updates to server
</li>
</ul>
</li>
<li>server
<ul class="org-ul">
<li>if file f is modified
<ul class="org-ul">
<li>foreach client holding valid cache of f
<ul class="org-ul">
<li>set client promise to cancelled
</li>
<li>remove client from list of valid clients
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-5-3-3-5-3" name="sec-5-3-3-5-3"></a>Problem<br  /><div class="outline-text-6" id="text-5-3-3-5-3">
<p>
If multiple clients write to a file concurrently, all updates are silently lost except those made by last client. Concurrency control must be implemented independently.
</p>
</div>
</li></ol>
</li></ol>
</div>
<div id="outline-container-sec-5-3-4" class="outline-4">
<h4 id="sec-5-3-4"><span class="section-number-4">5.3.4</span> Coda File System</h4>
<div class="outline-text-4" id="text-5-3-4">
</div><ol class="org-ol"><li><a id="sec-5-3-4-1" name="sec-5-3-4-1"></a>Overview<br  /><div class="outline-text-5" id="text-5-3-4-1">
<ul class="org-ul">
<li>designed to have high availability
<ul class="org-ul">
<li>client can continue operation when disconnected
</li>
</ul>
</li>
<li>disconnected w.r.t. a volume: 
<ul class="org-ul">
<li>can't access any server having a copy of it
</li>
</ul>
</li>
<li>ensure cache contains files to be accessed during disconnection
</li>
</ul>
</div>
</li>
<li><a id="sec-5-3-4-2" name="sec-5-3-4-2"></a>Hoarding<br  /><div class="outline-text-5" id="text-5-3-4-2">
<ul class="org-ul">
<li>ask user to specify useful files in a hoard DB
</li>
<li>compute priority from hoard DB + recent file access
</li>
<li>equlibrium
<ul class="org-ul">
<li>cached have higher priority than uncached
</li>
<li>cache is full or all uncached have 0 priority
</li>
<li>cached files are up-to-date
</li>
</ul>
</li>
<li>priority may change overtime
</li>
<li>cached may be replaced
</li>
<li>periodically reorganize cache to maintain equilibrium
</li>
</ul>
</div>
</li>
<li><a id="sec-5-3-4-3" name="sec-5-3-4-3"></a>Client State<br  /><ol class="org-ol"><li><a id="sec-5-3-4-3-1" name="sec-5-3-4-3-1"></a>Hoarding<br  /><div class="outline-text-6" id="text-5-3-4-3-1">
<p>
When connected, issue file requests to server(s) to perform work and attempts to keep cache filled with useful data
</p>
</div>
</li>
<li><a id="sec-5-3-4-3-2" name="sec-5-3-4-3-2"></a>Emulation<br  /><div class="outline-text-6" id="text-5-3-4-3-2">
<p>
When disconnected, requests are serviced using local copy
</p>
</div>
</li>
<li><a id="sec-5-3-4-3-3" name="sec-5-3-4-3-3"></a>Reintegration<br  /><div class="outline-text-6" id="text-5-3-4-3-3">
<p>
When reconnected, transfer updates to server
</p>
</div>
</li></ol>
</li>
<li><a id="sec-5-3-4-4" name="sec-5-3-4-4"></a>Conflicts<br  /><div class="outline-text-5" id="text-5-3-4-4">
<ul class="org-ul">
<li>during reintegration, conflicts may occur
</li>
<li>in such case, try conflict resolution
</li>
<li>if fail, manual intervention
</li>
<li>rare because UNIX &rarr; only one user access a file
</li>
</ul>
</div>
</li></ol>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> P2P File Sharing Systems</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Introduction</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li>All processes play similar roles, interact cooperatively
</li>
<li>No distinction between clients and servers
</li>
<li>Every node provides some service that helps other nodes
</li>
<li>Resources at edge have intermittent connectivity
<ul class="org-ul">
<li>Added and removed from time to time
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> Examples</h3>
<div class="outline-text-3" id="text-6-2">
</div><div id="outline-container-sec-6-2-1" class="outline-4">
<h4 id="sec-6-2-1"><span class="section-number-4">6.2.1</span> File sharing</h4>
<div class="outline-text-4" id="text-6-2-1">
<ul class="org-ul">
<li>Napster
</li>
<li>Gnutella
</li>
<li>KaZaA
</li>
<li>BitTorrent
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-2-2" class="outline-4">
<h4 id="sec-6-2-2"><span class="section-number-4">6.2.2</span> Communication</h4>
<div class="outline-text-4" id="text-6-2-2">
<ul class="org-ul">
<li>IM
</li>
<li>Skype VoIP
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-2-3" class="outline-4">
<h4 id="sec-6-2-3"><span class="section-number-4">6.2.3</span> DHT</h4>
<div class="outline-text-4" id="text-6-2-3">
<ul class="org-ul">
<li>Chord
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> Unstructured P2P File Sharing</h3>
<div class="outline-text-3" id="text-6-3">
</div><div id="outline-container-sec-6-3-1" class="outline-4">
<h4 id="sec-6-3-1"><span class="section-number-4">6.3.1</span> Overview</h4>
<div class="outline-text-4" id="text-6-3-1">
<ul class="org-ul">
<li>simple to build
</li>
<li>simple to understand
</li>
<li>can't analyse performance
<ul class="org-ul">
<li>new node randomly chooses exinting nodes when joins
</li>
<li>no coupling
</li>
<li>random search
</li>
<li>what is expected overhead of search?
</li>
</ul>
</li>
<li>need many copies to make search overhead small
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-3-2" class="outline-4">
<h4 id="sec-6-3-2"><span class="section-number-4">6.3.2</span> Napster</h4>
<div class="outline-text-4" id="text-6-3-2">
</div><ol class="org-ol"><li><a id="sec-6-3-2-1" name="sec-6-3-2-1"></a>Overview<br  /><div class="outline-text-5" id="text-6-3-2-1">
<ul class="org-ul">
<li>centralized dir server
<ul class="org-ul">
<li>centralized search
</li>
</ul>
</li>
<li>P2P distributed download
</li>
</ul>
</div>
</li>
<li><a id="sec-6-3-2-2" name="sec-6-3-2-2"></a>Steps<br  /><div class="outline-text-5" id="text-6-3-2-2">
<ol class="org-ol">
<li>Connect to Napster server
</li>
<li>Upload list of files to server
</li>
<li>Give keywords to search with
</li>
<li>Select best answers for downloading. User pings hosts that have the wanted file
</li>
<li>User chooses server and downloads file
</li>
</ol>
</div>
</li></ol>
</div>
<div id="outline-container-sec-6-3-3" class="outline-4">
<h4 id="sec-6-3-3"><span class="section-number-4">6.3.3</span> Gnutella</h4>
<div class="outline-text-4" id="text-6-3-3">
</div><ol class="org-ol"><li><a id="sec-6-3-3-1" name="sec-6-3-3-1"></a>Overview<br  /><div class="outline-text-5" id="text-6-3-3-1">
<ul class="org-ul">
<li>Search servers that have file you want by flooding
<ul class="org-ul">
<li>BFS
</li>
</ul>
</li>
<li>Reverse path forwarding for responses
</li>
</ul>
</div>
</li>
<li><a id="sec-6-3-3-2" name="sec-6-3-3-2"></a>How it works<br  /><div class="outline-text-5" id="text-6-3-3-2">
<ul class="org-ul">
<li>limit number of hops
<ul class="org-ul">
<li>user attaches TTL field to query message and init it with max allowable hop count
</li>
<li>for nodes receiving query,
<ul class="org-ul">
<li>if TTL &gt; 0, TTL&#x2013; and forward
</li>
<li>if TTL = 0, stop
</li>
</ul>
</li>
</ul>
</li>
<li>expanded-ring TTL search
<ul class="org-ul">
<li>try TTL = 1.
</li>
<li>if not found, try TTL = 2
</li>
<li>&#x2026;
</li>
<li>try TTL = max
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-6-3-3-3" name="sec-6-3-3-3"></a>Connection<br  /><div class="outline-text-5" id="text-6-3-3-3">
<ol class="org-ol">
<li>bootstrap node to get IP addresses of existing Gnutella nodes
</li>
<li>send join messages to some existing nodes
</li>
<li>relations established
</li>
</ol>
</div>
</li>
<li><a id="sec-6-3-3-4" name="sec-6-3-3-4"></a>Issues<br  /><div class="outline-text-5" id="text-6-3-3-4">
<ul class="org-ul">
<li>flooding is not scalable
</li>
<li>may generate huge traffic
</li>
<li>possibly incomplete downloads
</li>
<li>ineffective search
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-6-3-4" class="outline-4">
<h4 id="sec-6-3-4"><span class="section-number-4">6.3.4</span> KaZaA</h4>
<div class="outline-text-4" id="text-6-3-4">
</div><ol class="org-ol"><li><a id="sec-6-3-4-1" name="sec-6-3-4-1"></a>Architecture<br  /><div class="outline-text-5" id="text-6-3-4-1">
<ul class="org-ul">
<li>hierarchical
</li>
<li>each peer is either supernode or node assigned to supernode
</li>
<li>if more bandwidth and more available, assigned as supernodes
</li>
<li>each supernode tracks contents and IP address of its children
</li>
</ul>
</div>
</li>
<li><a id="sec-6-3-4-2" name="sec-6-3-4-2"></a>How it works<br  /><ol class="org-ol"><li><a id="sec-6-3-4-2-1" name="sec-6-3-4-2-1"></a>Metadata<br  /><div class="outline-text-6" id="text-6-3-4-2-1">
<ul class="org-ul">
<li>when node connects to supernode, upload metadata
</li>
<li>foreach file
<ul class="org-ul">
<li>file name, size
</li>
<li>ContentHash
</li>
<li>file descriptors
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-6-3-4-2-2" name="sec-6-3-4-2-2"></a>Connection<br  /><div class="outline-text-6" id="text-6-3-4-2-2">
<ul class="org-ul">
<li>get list of potential supernodes
</li>
<li>find operational supernode
<ul class="org-ul">
<li>connects, obtain more up-to-date list
</li>
<li>supernodes are close
</li>
<li>new peer pings 5 supernodes and connects to one
</li>
</ul>
</li>
<li>if down, node obtains updated list and chooses new supernode
</li>
</ul>
</div>
</li>
<li><a id="sec-6-3-4-2-3" name="sec-6-3-4-2-3"></a>Query<br  /><div class="outline-text-6" id="text-6-3-4-2-3">
<ol class="org-ol">
<li>send keyword query to supernode
</li>
<li>if &lt; x matches found, supernode forward
</li>
<li>if &lt; x matches found, forward
</li>
<li>result: ContentHash and list of nodes holding file
</li>
</ol>
</div>
</li>
<li><a id="sec-6-3-4-2-4" name="sec-6-3-4-2-4"></a>Download<br  /><div class="outline-text-6" id="text-6-3-4-2-4">
<ul class="org-ul">
<li>if available in multiple nodes, parallel downloading
</li>
<li>automatic recovery
<ul class="org-ul">
<li>client peer switch to new server peer when unavailable
</li>
<li>ContentHash is used to search for new copy
</li>
</ul>
</li>
</ul>
</div>
</li></ol>
</li></ol>
</div>
</div>
<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> Structured DHT Systems</h3>
<div class="outline-text-3" id="text-6-4">
</div><div id="outline-container-sec-6-4-1" class="outline-4">
<h4 id="sec-6-4-1"><span class="section-number-4">6.4.1</span> Overview</h4>
<div class="outline-text-4" id="text-6-4-1">
<ul class="org-ul">
<li>tight coupling between nodes and file locations
</li>
<li>assign nodes to hold particular contents
</li>
<li>want to distribute responsibilities among nodes
</li>
<li>when a node requests that content, go to node that is supposed to have/know about it
</li>
<li>arrange neighbour relationship between nodes in a restrictive structure to facilitate query routing
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-4-2" class="outline-4">
<h4 id="sec-6-4-2"><span class="section-number-4">6.4.2</span> DHT Services</h4>
<div class="outline-text-4" id="text-6-4-2">
</div><ol class="org-ol"><li><a id="sec-6-4-2-1" name="sec-6-4-2-1"></a>The Hash<br  /><div class="outline-text-5" id="text-6-4-2-1">
<ul class="org-ul">
<li>hash function:
<ul class="org-ul">
<li>files &rarr; [0,k]
</li>
</ul>
</li>
<li>distribute [0,k] among all nodes
</li>
<li>node [l,r] is responsible for files that are mapped into l &le; x &le; r
<ul class="org-ul">
<li>direct
<ul class="org-ul">
<li>physically store files
</li>
</ul>
</li>
<li>indirect
<ul class="org-ul">
<li>stores locations of files
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-6-4-2-2" name="sec-6-4-2-2"></a>Routing<br  /><div class="outline-text-5" id="text-6-4-2-2">
<ul class="org-ul">
<li>query efficiently routed to node whose range covers file
</li>
<li>implemented in fully distributed manner
</li>
<li>each node maintains info of range spaces covered by some other nodes
</li>
<li>complexity must scale with system growth
</li>
<li>gracefully handle node joining/leaving system
<ul class="org-ul">
<li>bootstrap to connect
</li>
<li>repartition range on joining/leaving nodes
</li>
<li>reorganize/update routing info
</li>
</ul>
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-6-4-3" class="outline-4">
<h4 id="sec-6-4-3"><span class="section-number-4">6.4.3</span> Consistent Hashing</h4>
<div class="outline-text-4" id="text-6-4-3">
<ul class="org-ul">
<li>Range [0,2<sup>m</sup>-1]
</li>
<li>Let ..p n s .. be among the graph. Let f(i) be the assigned number to node i. Then node n is responsible for nodes [f(p)+1 mod 2<sup>m</sup>-1,f(n) mod 2<sup>m</sup>-1].
</li>
<li>Each file is held in a node with node<sub>id</sub> &ge; file<sub>id</sub>
</li>
</ul>
</div>
<ol class="org-ol"><li><a id="sec-6-4-3-1" name="sec-6-4-3-1"></a>Scheme 1<br  /><div class="outline-text-5" id="text-6-4-3-1">
<ul class="org-ul">
<li>each node maintains ID and IP of successor
</li>
<li>low complexity of routing info
</li>
<li>high complexity of query routing
</li>
</ul>
</div>
</li>
<li><a id="sec-6-4-3-2" name="sec-6-4-3-2"></a>Scheme 2<br  /><div class="outline-text-5" id="text-6-4-3-2">
<ul class="org-ul">
<li>each node maintains ID and IP of all nodes
</li>
<li>low complexity of query routing
</li>
<li>high complexity of routing info
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-6-4-4" class="outline-4">
<h4 id="sec-6-4-4"><span class="section-number-4">6.4.4</span> Chord</h4>
<div class="outline-text-4" id="text-6-4-4">
</div><ol class="org-ol"><li><a id="sec-6-4-4-1" name="sec-6-4-4-1"></a>Method<br  /><div class="outline-text-5" id="text-6-4-4-1">
<ul class="org-ul">
<li>each node maintains ID and IP of nodes in a finger table
</li>
<li><code>table[n][i]</code> = ID and IP of first node that succeeds n by at least 2<sup>(i-1)</sup> on ID circle
<ul class="org-ul">
<li>each entry called a finger
</li>
</ul>
</li>
<li>suppose want to query key k at node n, then lookup the table[n][log2(k-n)+1]
</li>
<li>O(lgN) routing information, O(lgN) query routing
</li>
<li>query can always be routed correctly as long as each node knows its correct successor node
</li>
</ul>
</div>
</li>
<li><a id="sec-6-4-4-2" name="sec-6-4-4-2"></a>Node Join<br  /><div class="outline-text-5" id="text-6-4-4-2">
<ul class="org-ul">
<li>if each node maintains info about its predecessor node, the node join is similar to doubly-linked list node join
<ol class="org-ol">
<li>n uses bootstrapping process to find node
</li>
<li>n asks node to locate n's successor by key n
</li>
<li>n sets successor node
</li>
<li>n's predecessor is successor's predecessor
</li>
<li>n's predecessor's successor is n
</li>
<li>n's successor's predecessor is n
</li>
<li>build up finger table by querying
</li>
<li>let p be predecessor, s be successor
<ul class="org-ul">
<li>foreach i in [1..m],
<ul class="org-ul">
<li>foreach node x in [p-2<sup>(i-1)</sup>+1,n-2<sup>(i-1)</sup>],
<ul class="org-ul">
<li>table[x][i] = n
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>
log<sup>2</sup>(N) complexity of node insertion
</p>
</li>
<li>n reports files that it is willing to share to nodes responsible for them
</li>
</ol>
</li>
</ul>
</div>
</li>
<li><a id="sec-6-4-4-3" name="sec-6-4-4-3"></a>Node Leave<br  /><div class="outline-text-5" id="text-6-4-4-3">
<p>
Similar to node join
</p>
</div>
</li></ol>
</div>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Name Services</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Names and Name Services</h3>
<div class="outline-text-3" id="text-7-1">
</div><div id="outline-container-sec-7-1-1" class="outline-4">
<h4 id="sec-7-1-1"><span class="section-number-4">7.1.1</span> Names and Addresses</h4>
<div class="outline-text-4" id="text-7-1-1">
<ul class="org-ul">
<li>Resources need to identify each other
</li>
<li>Names identify resources in a location-independent fashion
</li>
<li>Addresses identify resources in a location-dependent fashion
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-1-2" class="outline-4">
<h4 id="sec-7-1-2"><span class="section-number-4">7.1.2</span> Name Service</h4>
<div class="outline-text-4" id="text-7-1-2">
<ul class="org-ul">
<li>name &rarr; address
</li>
<li>DNS: domain names &harr; IP address
</li>
<li>Java RMIregistry: remote object name &harr; remote object ref
</li>
<li>Name resolution: name &rarr; address
<ul class="org-ul">
<li>may involve &gt;1 translation
<ul class="org-ul">
<li>domain &rarr; IP address &rarr; MAC (by ARP)
</li>
</ul>
</li>
<li>pathname by filesystem
</li>
</ul>
</li>
<li>Generally
<ul class="org-ul">
<li>address is just one of many attributes of resources
</li>
<li>names &harr; attributes
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-1-3" class="outline-4">
<h4 id="sec-7-1-3"><span class="section-number-4">7.1.3</span> Main Requirements</h4>
<div class="outline-text-4" id="text-7-1-3">
<ul class="org-ul">
<li>scalability
<ul class="org-ul">
<li>arbitrary number of names
</li>
<li>arbitrary number of administrative organizations
</li>
</ul>
</li>
<li>reliability
<ul class="org-ul">
<li>high availability
</li>
<li>no failure
</li>
</ul>
</li>
<li>performance
<ul class="org-ul">
<li>shouldn't introduce much delay
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-1-4" class="outline-4">
<h4 id="sec-7-1-4"><span class="section-number-4">7.1.4</span> Namespace</h4>
<div class="outline-text-4" id="text-7-1-4">
<ul class="org-ul">
<li>collection of all valid names
<ul class="org-ul">
<li>requires syntactic definition
</li>
</ul>
</li>
<li>can have hierarchical structure
<ul class="org-ul">
<li>each part resolved relative to a separate context
</li>
<li>same name diff meanings in diff contexts
</li>
<li>e.g. UNIX filesystem
</li>
<li>more scalability
</li>
</ul>
</li>
<li>can have flat structure
</li>
<li>e.g. DNS
<ul class="org-ul">
<li>hierarchical
</li>
<li>domain name: &ge;1 strings separated by dot
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-1-5" class="outline-4">
<h4 id="sec-7-1-5"><span class="section-number-4">7.1.5</span> Name Resolution Process</h4>
<div class="outline-text-4" id="text-7-1-5">
<ul class="org-ul">
<li>name server maintain name &rarr; address mappings
<ul class="org-ul">
<li>binding: name &rarr; resource
</li>
<li>unbound: name doesn't correspond resource
</li>
</ul>
</li>
<li>physically, resolution may involve more than 1 nameserver
<ul class="org-ul">
<li>may not be available at every nameserver; hierarchical namespace
</li>
<li>iterative client-controlled navigation
</li>
<li>non-recursive server-controlled navigation
</li>
<li>recursive server-controlled navigation
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-1-6" class="outline-4">
<h4 id="sec-7-1-6"><span class="section-number-4">7.1.6</span> Iterative Client-Controlled Navigation</h4>
<div class="outline-text-4" id="text-7-1-6">
<ul class="org-ul">
<li>iteratively contacts a group of NS to resolve name
<ul class="org-ul">
<li>NS1,..,NS<sub>i</sub>,NS<sub>i</sub>+1,..
</li>
<li>Potentially high communication cost if far away
</li>
</ul>
</li>
<li>variation: multicast navigation
<ul class="org-ul">
<li>client multicasts name to group of NS
</li>
<li>server holding name mapping responds
</li>
<li>possibly faster response
</li>
<li>possibly more network traffic
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-1-7" class="outline-4">
<h4 id="sec-7-1-7"><span class="section-number-4">7.1.7</span> Nonrecursive Server-Controlled Navigation</h4>
<div class="outline-text-4" id="text-7-1-7">
<ul class="org-ul">
<li>nameserver coordinates name resolution process on behalf of a client then passes back to client
</li>
<li>communicates by multicast/iteratively like a client
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-1-8" class="outline-4">
<h4 id="sec-7-1-8"><span class="section-number-4">7.1.8</span> Recursive Server-Controlled Navigation</h4>
<div class="outline-text-4" id="text-7-1-8">
<ul class="org-ul">
<li>recursively find until found
</li>
<li>caching results is more effective
</li>
<li>higher performance demand on each nameserver
<ul class="org-ul">
<li>may tie up server threads
</li>
<li>may delay other requests
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> Domain Name System</h3>
<div class="outline-text-3" id="text-7-2">
</div><div id="outline-container-sec-7-2-1" class="outline-4">
<h4 id="sec-7-2-1"><span class="section-number-4">7.2.1</span> Overview</h4>
<div class="outline-text-4" id="text-7-2-1">
</div><ol class="org-ol"><li><a id="sec-7-2-1-1" name="sec-7-2-1-1"></a>Scalability<br  /><div class="outline-text-5" id="text-7-2-1-1">
<ul class="org-ul">
<li>hierarchical namespace
</li>
<li>namespace is partitioned and managed by large group of nameservers
</li>
</ul>
</div>
</li>
<li><a id="sec-7-2-1-2" name="sec-7-2-1-2"></a>Reliability<br  /><div class="outline-text-5" id="text-7-2-1-2">
<ul class="org-ul">
<li>uses replication
</li>
</ul>
</div>
</li>
<li><a id="sec-7-2-1-3" name="sec-7-2-1-3"></a>Performance<br  /><div class="outline-text-5" id="text-7-2-1-3">
<ul class="org-ul">
<li>uses caching
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-7-2-2" class="outline-4">
<h4 id="sec-7-2-2"><span class="section-number-4">7.2.2</span> Hierarchical Name Space</h4>
<div class="outline-text-4" id="text-7-2-2">
<ul class="org-ul">
<li>DNS manage names of computers and domains
</li>
<li>domains associated with organizations
<ul class="org-ul">
<li>tree-like hierarchical structure refecting structure of organizations
</li>
</ul>
</li>
<li>each domain manages own names
<ul class="org-ul">
<li>NTU gets name from whoever is in charge of edu.sg
</li>
<li>Afterwards, it is free to assign hostnames within NTU w/o going back to edu.sg administration
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-2-3" class="outline-4">
<h4 id="sec-7-2-3"><span class="section-number-4">7.2.3</span> Name Space Partitioning</h4>
<div class="outline-text-4" id="text-7-2-3">
<ul class="org-ul">
<li>in original internet naming system, all hostnames and addresses were held in a single central master file downloaded by FTP to all computers
<ul class="org-ul">
<li>did not scale well
</li>
<li>replaced by DNS
</li>
</ul>
</li>
<li>DNS is decentralized
<ul class="org-ul">
<li>no single server is responsible for all names
</li>
<li>entire name space is partitioned among largs group of name servers
</li>
<li>each server holds authoritative mappings for names in one or more domains
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7-2-4" class="outline-4">
<h4 id="sec-7-2-4"><span class="section-number-4">7.2.4</span> DNS Name Servers</h4>
<div class="outline-text-4" id="text-7-2-4">
<ul class="org-ul">
<li>information held
<ul class="org-ul">
<li>name &rarr; IP addr for local domain
</li>
<li>name &amp; address of all name servers in local domain
</li>
<li>name &amp; address of name servers in its subdomains
</li>
<li>name &amp; address of root name servers
</li>
</ul>
</li>
<li>each mapping contains: name+time-to-live+class+type+value
</li>
<li>allows multiple names to be mapped into same IP address
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-2-5" class="outline-4">
<h4 id="sec-7-2-5"><span class="section-number-4">7.2.5</span> DNS Queries</h4>
<div class="outline-text-4" id="text-7-2-5">
</div><ol class="org-ol"><li><a id="sec-7-2-5-1" name="sec-7-2-5-1"></a>Host name resolution<br  /><div class="outline-text-5" id="text-7-2-5-1">
<p>
To resolve host names into IP addresses
</p>
</div>
</li>
<li><a id="sec-7-2-5-2" name="sec-7-2-5-2"></a>Mail host location<br  /><div class="outline-text-5" id="text-7-2-5-2">
<p>
To resolve domain names into IP addresses of mail hosts
</p>
</div>
</li></ol>
</div>
<div id="outline-container-sec-7-2-6" class="outline-4">
<h4 id="sec-7-2-6"><span class="section-number-4">7.2.6</span> Replication for Reliability</h4>
<div class="outline-text-4" id="text-7-2-6">
<p>
Authoritative mappings of each domain must be held by &ge;2 name servers.
</p>
<ol class="org-ol">
<li>Primary server
Reads mappings directly from local master file.
</li>
<li>Secondary servers
<ul class="org-ul">
<li>Download mappings from primary server.
</li>
<li>Periodically checks w/ primary server to see whether stored mappings are up-to-date
</li>
</ul>
</li>
</ol>

<p>
Root domain has about 12 secondary servers to share heavy workload.
</p>
</div>
</div>
<div id="outline-container-sec-7-2-7" class="outline-4">
<h4 id="sec-7-2-7"><span class="section-number-4">7.2.7</span> DNS Name Resolution Process</h4>
<div class="outline-text-4" id="text-7-2-7">
<ul class="org-ul">
<li>uses simple request-reply protocol over UDP
<ul class="org-ul">
<li>name server implements BIND
</li>
<li>name servers use well known port number
</li>
<li>DNS client is called resolver
</li>
</ul>
</li>
<li>primarily uses combination of iterative client-controlled navigation and non-recursive server-controlled navigation
<ul class="org-ul">
<li>client contacts first server it knows of &amp; progresses if unavailable
</li>
<li>non-recursive server-controlled navigation is then used
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-2-8" class="outline-4">
<h4 id="sec-7-2-8"><span class="section-number-4">7.2.8</span> Caching</h4>
<div class="outline-text-4" id="text-7-2-8">
<ul class="org-ul">
<li>uses caching to improve performance
<ul class="org-ul">
<li>@ client
</li>
<li>@ name server
</li>
</ul>
</li>
<li>always consult caches before sending queries to other servers
</li>
<li>advantages
<ul class="org-ul">
<li>reduce response time
</li>
<li>save network traffic
</li>
<li>alleviate workload of high-level name servers
</li>
</ul>
</li>
<li>introduces consistency problem
<ul class="org-ul">
<li>query answers returned from mappings are called non-authoritative answers
</li>
<li>mappings and hence non-authoritative answers may be out-of-date
</li>
</ul>
</li>
<li>timeout to address consistency problem
<ul class="org-ul">
<li>time-to-live values for cache expiry time
</li>
<li>stale answers may still be provided before timeout
</li>
<li>longer time-to-live &rarr; weaker consistency
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Time and Global States</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> Synchronizing Physical Clocks</h3>
<div class="outline-text-3" id="text-8-1">
</div><div id="outline-container-sec-8-1-1" class="outline-4">
<h4 id="sec-8-1-1"><span class="section-number-4">8.1.1</span> Computer Clocks</h4>
<div class="outline-text-4" id="text-8-1-1">
<ul class="org-ul">
<li>computers have their own physical clocks that deviate from one another
</li>
<li><b>offset</b>: instantaneous difference between readings of two clocks
</li>
<li><b>reference clock e.g. UTC</b>: ignals are broadcasted regularly from land-based radio stations and statellites around world
</li>
<li><b>clock drift</b>: clocks count time at different rates
</li>
<li><b>drift rate</b>: change in offset between a clock and a perfect reference clock per unit of time measured by reference clock
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-1-2" class="outline-4">
<h4 id="sec-8-1-2"><span class="section-number-4">8.1.2</span> Cristian's Method</h4>
<div class="outline-text-4" id="text-8-1-2">
<p>
Suppose A wants to sync with B.
</p>
<ul class="org-ul">
<li>A requests
</li>
<li>B replies T<sub>B</sub>
</li>
<li>A records T<sub>round</sub> = t<sub>2</sub> - t<sub>1</sub>
</li>
<li>A sets clock to T<sub>B</sub> + T<sub>round</sub>/2
</li>
</ul>

<p>
When A receives reply, time reading in B &isin; [T<sub>B</sub>,T<sub>B</sub>+T<sub>round</sub>]. Taking the middle, A sets clock to T<sub>B</sub> + T<sub>round</sub>/2, so accuracy is +/- T<sub>round</sub>/2.
</p>

<p>
To handle variability, make serveral requests to B and take min{T<sub>round</sub>} for most accurate estimate.
</p>
</div>
</div>
<div id="outline-container-sec-8-1-3" class="outline-4">
<h4 id="sec-8-1-3"><span class="section-number-4">8.1.3</span> Berkeley Algorithm</h4>
<div class="outline-text-4" id="text-8-1-3">
</div><ol class="org-ol"><li><a id="sec-8-1-3-1" name="sec-8-1-3-1"></a>Definitions<br  /><ol class="org-ol"><li><a id="sec-8-1-3-1-1" name="sec-8-1-3-1-1"></a>Master<br  /><div class="outline-text-6" id="text-8-1-3-1-1">
<p>
Coordinator computer
</p>
</div>
</li>
<li><a id="sec-8-1-3-1-2" name="sec-8-1-3-1-2"></a>Slaves<br  /><div class="outline-text-6" id="text-8-1-3-1-2">
<p>
Other computers whose clocks are to be sync'ed.
</p>
</div>
</li></ol>
</li>
<li><a id="sec-8-1-3-2" name="sec-8-1-3-2"></a>How it works<br  /><div class="outline-text-5" id="text-8-1-3-2">
<ol class="org-ol">
<li>Master periodically polls slaves
</li>
<li>Slaves reply with clocks
</li>
<li>Master evaluates local times of slaves by T<sub>round</sub>
</li>
<li>Master averages values obtained
</li>
<li>Master sends amount of adjustment to each slave
</li>
</ol>

<p>
If master fails, elect another computer.
</p>
</div>
</li></ol>
</div>
<div id="outline-container-sec-8-1-4" class="outline-4">
<h4 id="sec-8-1-4"><span class="section-number-4">8.1.4</span> NTP</h4>
<div class="outline-text-4" id="text-8-1-4">
</div><ol class="org-ol"><li><a id="sec-8-1-4-1" name="sec-8-1-4-1"></a>Comparison<br  /><div class="outline-text-5" id="text-8-1-4-1">
<ul class="org-ul">
<li>over internet, while former two are over intranets
</li>
<li>decentralized, while former two are centralized
</li>
</ul>
</div>
</li>
<li><a id="sec-8-1-4-2" name="sec-8-1-4-2"></a>Architecture<br  /><div class="outline-text-5" id="text-8-1-4-2">
<ul class="org-ul">
<li>a network of servers are structured hierarchically into synchronization subnet
<ul class="org-ul">
<li>primary servers (stratum 1) connected directly to time source
</li>
<li>statum i are sync'ed with stratum i-1, &forall; i &ge; 2
</li>
<li>Lowest level servers execute in users' workstations
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-8-1-4-3" name="sec-8-1-4-3"></a>Fault-tolerance<br  /><div class="outline-text-5" id="text-8-1-4-3">
<ul class="org-ul">
<li>servers can reconfigure themselves
<ul class="org-ul">
<li>if primary server UTC source fails, make it to be stratum 2 server.
</li>
<li>if stratum 2 server's source of sync fails, sync with another primary server.
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-8-1-4-4" name="sec-8-1-4-4"></a>Message Exchange<br  /><div class="outline-text-5" id="text-8-1-4-4">
<ul class="org-ul">
<li>contains:
<ul class="org-ul">
<li>local times when previous NTP message between pair was sent&amp;received.
</li>
<li>local time when current NTP message was sent.
</li>
</ul>
</li>
<li>Example
<ul class="org-ul">
<li>Suppose m is sent from A to B at T<sub>i-3</sub> and arrives at T<sub>i-2</sub>.
Suppose m' is sent from B to A at T<sub>i-1</sub> and arrives at T<sub>i</sub>.
</li>
<li>Total transmission time is (T<sub>i</sub>-T<sub>i-3</sub>) - (T<sub>i-1</sub>-T<sub>i-2</sub>).
Transmission time of m' &isin; [0,(T<sub>i</sub>-T<sub>i-3</sub>) - (T<sub>i-1</sub>-T<sub>i-2</sub>)].
If it is 0, when A receives m', B's clock is T<sub>i-1</sub>.
If it is (T<sub>i</sub>-T<sub>i-3</sub>) - (T<sub>i-1</sub>-T<sub>i-2</sub>), when A receives m', B's clock is T<sub>i-1</sub> + (T<sub>i</sub>-T<sub>i-3</sub>) - (T<sub>i-1</sub>-T<sub>i-2</sub>) = T<sub>i</sub>-T<sub>i-3</sub>+T<sub>i-2</sub>
In any case, when A receives m', B's clock reading &isin; [T<sub>i-1</sub>, T<sub>i</sub>-T<sub>i-3</sub>+T<sub>i-2</sub>]. Taking the middle point, A should set clock to 1/2 (T<sub>i-1</sub> + T<sub>i</sub>-T<sub>i-3</sub>+T<sub>i-2</sub>). Accuracy is +/- 1/2 (T<sub>i-1</sub> - (T<sub>i</sub>-T<sub>i-3</sub>+T<sub>i-2</sub>)).
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-8-1-4-5" name="sec-8-1-4-5"></a>Misc<br  /><div class="outline-text-5" id="text-8-1-4-5">
<ul class="org-ul">
<li>applies data filtering to improve accuracy of synchronization over time
<ul class="org-ul">
<li>retain estimates of 8 most recent message exchanges and their accuracies
</li>
<li>choose one with highest accuracy
</li>
</ul>
</li>
<li>to choose peer, NTP server engages in message exchanges with several peers and applies peer-selection algo.
</li>
</ul>
</div>
</li></ol>
</div>
</div>
<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> Causal Ordering and Logical Clocks</h3>
<div class="outline-text-3" id="text-8-2">
</div><div id="outline-container-sec-8-2-1" class="outline-4">
<h4 id="sec-8-2-1"><span class="section-number-4">8.2.1</span> System model</h4>
<div class="outline-text-4" id="text-8-2-1">
</div><ol class="org-ol"><li><a id="sec-8-2-1-1" name="sec-8-2-1-1"></a>Distributed system<br  /><div class="outline-text-5" id="text-8-2-1-1">
<ul class="org-ul">
<li>N processes p<sub>1</sub>,..,p<sub>N</sub>
</li>
<li>each process on single processor
</li>
<li>no shared memory
</li>
<li>only way to communicate is through message passing through network
</li>
<li>reliable communication channels
</li>
<li><b>asynchronous system</b>: no bounds on execution speed, transmission delays, clock drift rates
</li>
</ul>
</div>
</li>
<li><a id="sec-8-2-1-2" name="sec-8-2-1-2"></a>Process state<br  /><div class="outline-text-5" id="text-8-2-1-2">
<ul class="org-ul">
<li>values of all variables within the process
</li>
<li>values of any objects in local OS environment that process affects
</li>
<li>let s<sub>i</sub> be state of process p<sub>i</sub>
</li>
</ul>
</div>
</li>
<li><a id="sec-8-2-1-3" name="sec-8-2-1-3"></a>Process execution<br  /><div class="outline-text-5" id="text-8-2-1-3">
<ul class="org-ul">
<li>process takes a series of actions, either:
<ul class="org-ul">
<li>send message
</li>
<li>receive message
</li>
<li>internal action that transforms state
</li>
</ul>
</li>
<li><b>event</b>: occurence of a single action
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-8-2-2" class="outline-4">
<h4 id="sec-8-2-2"><span class="section-number-4">8.2.2</span> Causal Ordering</h4>
<div class="outline-text-4" id="text-8-2-2">
<ul class="org-ul">
<li>in asynchronous system, events can be ordered based on cause-and-effect
<ul class="org-ul">
<li>events within p<sub>i</sub> can be placed in a unique total ordering
<ul class="org-ul">
<li>sequence of events within single process p<sub>i</sub> is well defined
</li>
</ul>
</li>
<li>whenever message is sent between processes, event of sending message occurs before event of receiving message 
</li>
</ul>
</li>
<li>denoted by &rarr;
</li>
<li>is a <b>partial ordering</b>: there may exist pairs of events that remain unordered
</li>
<li>if !(e &rarr; e') and !(e' &rarr; e), then e || e'.
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-2-3" class="outline-4">
<h4 id="sec-8-2-3"><span class="section-number-4">8.2.3</span> Lamport's Logical Clocks</h4>
<div class="outline-text-4" id="text-8-2-3">
</div><ol class="org-ol"><li><a id="sec-8-2-3-1" name="sec-8-2-3-1"></a>Description<br  /><div class="outline-text-5" id="text-8-2-3-1">
<ul class="org-ul">
<li><b>logical clock</b>: a monotonically increasing SW counter whose value bears no relationship with time
</li>
<li>p<sub>i</sub> keeps logical clock L<sub>i</sub> to timestamp events
</li>
</ul>
</div>
</li>
<li><a id="sec-8-2-3-2" name="sec-8-2-3-2"></a>How it works<br  /><div class="outline-text-5" id="text-8-2-3-2">
<ol class="org-ol">
<li>&forall; i, L<sub>i</sub> = 0
</li>
<li>Foreach event, increments L<sub>i</sub>++ before timestamping it
</li>
<li>When p<sub>i</sub> sends m, t=L<sub>i</sub> is piggybacked
</li>
<li>When p<sub>j</sub> receives (m,t), set L<sub>j</sub> = max(L<sub>j</sub>,t) before incrementing to timestamp
</li>
</ol>
</div>
</li>
<li><a id="sec-8-2-3-3" name="sec-8-2-3-3"></a>Theorem<br  /><div class="outline-text-5" id="text-8-2-3-3">
<p>
e &rarr; e' &rArr; L(e) &lt; L(e')
</p>
</div>
</li></ol>
</div>
<div id="outline-container-sec-8-2-4" class="outline-4">
<h4 id="sec-8-2-4"><span class="section-number-4">8.2.4</span> Vector Clocks</h4>
<div class="outline-text-4" id="text-8-2-4">
</div><ol class="org-ol"><li><a id="sec-8-2-4-1" name="sec-8-2-4-1"></a>Description<br  /><div class="outline-text-5" id="text-8-2-4-1">
<ul class="org-ul">
<li>V<sub>i[1</sub>..N] = vector clock of process i
</li>
<li>Sets V<sub>i[i]</sub>++ before timestamping each event at p<sub>i</sub>
</li>
<li>When p<sub>i</sub> sends m, t=V<sub>i</sub> is piggybacked
</li>
<li>When p<sub>j</sub> receives (m,t), set V<sub>j[k]</sub> = max(V<sub>j[k]</sub>,t[k]) &forall; k &isin; [1,N] before incrementing V<sub>j[j]</sub> to timestamp
</li>
</ul>
</div>
</li>
<li><a id="sec-8-2-4-2" name="sec-8-2-4-2"></a>Rules<br  /><div class="outline-text-5" id="text-8-2-4-2">
<ul class="org-ul">
<li>V = V' &hArr; V[k] = V'[k] &forall; k
</li>
<li>V &le; V' &hArr; V[k] &le; V'[k] &forall; k
</li>
<li>V &lt; V' &hArr; V &le; V' and V &ne; V'
</li>
</ul>
</div>
</li>
<li><a id="sec-8-2-4-3" name="sec-8-2-4-3"></a>Theorem<br  /><div class="outline-text-5" id="text-8-2-4-3">
<ul class="org-ul">
<li>e &rarr; e' &hArr; V(e) &lt; V(e')
</li>
<li>Incomparable timestamps when concurrent:
<ul class="org-ul">
<li>e || e' &hArr; !(V(e) &le; V(e')) and !(V(e') &le; V(e))
</li>
</ul>
</li>
</ul>
</div>
</li></ol>
</div>
</div>
<div id="outline-container-sec-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> Global States</h3>
<div class="outline-text-3" id="text-8-3">
</div><div id="outline-container-sec-8-3-1" class="outline-4">
<h4 id="sec-8-3-1"><span class="section-number-4">8.3.1</span> Motivation</h4>
<div class="outline-text-4" id="text-8-3-1">
<p>
Need to find out whether a property is true when DS executes
e.g. distributed deadlock detection
</p>
<ul class="org-ul">
<li>each collection of processes waits for another
</li>
<li>cycle in grah of "wait-for" relationship
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-3-2" class="outline-4">
<h4 id="sec-8-3-2"><span class="section-number-4">8.3.2</span> System Model</h4>
<div class="outline-text-4" id="text-8-3-2">
<ul class="org-ul">
<li><b>history of p<sub>i</sub></b>: all events within p<sub>i</sub> and ordered by their occurences
<ul class="org-ul">
<li>h<sub>i</sub> = &lt;e<sub>i</sub><sup>1</sup>,e<sub>i</sub><sup>2</sup>,..&gt;
</li>
</ul>
</li>
<li><b>prefix of history of p<sub>i</sub></b>: first k events in h<sub>i</sub>
<ul class="org-ul">
<li>h<sub>i</sub><sup>k</sup> = &lt;e<sub>i</sub><sup>1</sup>,e<sub>i</sub><sup>2</sup>,..,e<sub>i</sub><sup>k</sup>&gt;
</li>
</ul>
</li>
<li><b>cut</b>: union of prefixes of histories
<ul class="org-ul">
<li>C = h<sub>1</sub><sup>c<sub>1</sub></sup> &cup; h<sub>2</sub><sup>c<sub>2</sub></sup> &cup; .. &cup; h<sub>N</sub><sup>c<sub>N</sub></sup>
</li>
</ul>
</li>
<li><b>global state</b>: set of states of all processes
<ul class="org-ul">
<li>let s<sub>i</sub><sup>k</sup> be state of p<sub>i</sub> after k<sup>th</sup> event occurence
</li>
<li>note that each global state &lt;s<sub>1</sub><sup>c<sub>1</sub></sup>,s<sub>2</sub><sup>c<sub>2</sub></sup>,..,s<sub>N</sub><sup>c<sub>N</sub></sup>&gt; corresponds to a cut
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-3-3" class="outline-4">
<h4 id="sec-8-3-3"><span class="section-number-4">8.3.3</span> Consistent Cut</h4>
<div class="outline-text-4" id="text-8-3-3">
<ul class="org-ul">
<li>interested in cuts that are consistent
</li>
<li><b>cut C is consistent</b>: &forall; event e &isin; C, f &rarr; e &rArr; f &isin; C
</li>
<li>otherwise, not consistent
</li>
<li>the corresponding global state of consistent cut is called a consistent global state
</li>
<li>in reality, system passes through consistent global states only
</li>
<li>gurantees 0 deadlock
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-3-4" class="outline-4">
<h4 id="sec-8-3-4"><span class="section-number-4">8.3.4</span> Recording Snapshot</h4>
<div class="outline-text-4" id="text-8-3-4">
<ul class="org-ul">
<li>steps
<ol class="org-ol">
<li>p<sub>1</sub> records its local state
</li>
<li>p<sub>1</sub> sends m to p<sub>2</sub>
</li>
<li>p<sub>2</sub> records its local state ASAP upon receival
</li>
</ol>
</li>
<li>need to include state of communication channel
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-3-5" class="outline-4">
<h4 id="sec-8-3-5"><span class="section-number-4">8.3.5</span> Chandy &amp; Lamport Algorithm</h4>
<div class="outline-text-4" id="text-8-3-5">
</div><ol class="org-ol"><li><a id="sec-8-3-5-1" name="sec-8-3-5-1"></a>Theorem<br  /><div class="outline-text-5" id="text-8-3-5-1">
<p>
Chandy &amp; Lamport Algorithm always selects a consistent cut
</p>
</div>
</li></ol>
</div>
</div>
<div id="outline-container-sec-8-4" class="outline-3">
<h3 id="sec-8-4"><span class="section-number-3">8.4</span> Distributed Debugging</h3>
<div class="outline-text-3" id="text-8-4">
</div><div id="outline-container-sec-8-4-1" class="outline-4">
<h4 id="sec-8-4-1"><span class="section-number-4">8.4.1</span> Description</h4>
<div class="outline-text-4" id="text-8-4-1">
<ul class="org-ul">
<li>to establish what occurred during execution of DS
</li>
<li>to check whether they are correct
</li>
<li>but there is no global time!
</li>
<li>can use Chandy and Lamport to repeatedly record snapshots?
</li>
<li><b>approach</b>: enumerate all consistent global states and check exhaustively
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-4-2" class="outline-4">
<h4 id="sec-8-4-2"><span class="section-number-4">8.4.2</span> Lattice of Consistent Global States</h4>
<div class="outline-text-4" id="text-8-4-2">
<ul class="org-ul">
<li>starting from initial state, advance one at a time
</li>
<li>each path from root to leaf represents an ordering of events that is consistent with causal ordering
</li>
<li>among possible paths, we can't tell which one actually executed since no global time
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-4-3" class="outline-4">
<h4 id="sec-8-4-3"><span class="section-number-4">8.4.3</span> Observing Consistent Global States</h4>
<div class="outline-text-4" id="text-8-4-3">
<ul class="org-ul">
<li>use additional monitor outside system to observe
</li>
<li>all processes in system send states to monitor
<ul class="org-ul">
<li>p<sub>i</sub> sends its initial state to the monitor process initially
</li>
<li>@e<sub>i</sub><sup>c<sub>i</sub></sup>, p<sub>i</sub> sends state to the monitor
</li>
</ul>
</li>
<li>monitor assembles consistent global states
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-4-4" class="outline-4">
<h4 id="sec-8-4-4"><span class="section-number-4">8.4.4</span> Global State Consistency Theorem</h4>
<div class="outline-text-4" id="text-8-4-4">
<ul class="org-ul">
<li><b>global state</b>: &lt;s<sub>1</sub><sup>c<sub>1</sub></sup>,s<sub>2</sub><sup>c<sub>2</sub></sup>,..,s<sub>N</sub><sup>c<sub>N</sub></sup>&gt;
</li>
<li>V(e<sub>i</sub><sup>c<sub>i</sub></sup>): vector clock timestamp of e<sub>i</sub><sup>c<sub>i</sub></sup>
</li>
<li>&lt;s<sub>1</sub><sup>c<sub>1</sub></sup>,s<sub>2</sub><sup>c<sub>2</sub></sup>,..,s<sub>N</sub><sup>c<sub>N</sub></sup>&gt; is consistent &hArr; &forall; i,j, V(e<sub>i</sub><sup>c<sub>i</sub></sup>)[i] &ge; V(e<sub>j</sub><sup>c<sub>j</sub></sup>)[i]
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-4-5" class="outline-4">
<h4 id="sec-8-4-5"><span class="section-number-4">8.4.5</span> Debugging</h4>
<div class="outline-text-4" id="text-8-4-5">
<p>
How to check if constraint is broken?
</p>
<ol class="org-ol">
<li>construct lattice
</li>
<li>foreach consistent global state, evaluate whether constraint satisfied
<ul class="org-ul">
<li>if all states satisfy, constraint can't be broken
</li>
<li>if &exist; state not satisfying, possible to be broken
</li>
<li>if every path passes through &ge;1 state not satisfying constraint, must be broken
</li>
</ul>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Coordination and Agreement</h2>
<div class="outline-text-2" id="text-9">
</div><div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> Introduction</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Shared values in DS is a problem.
</p>
<ul class="org-ul">
<li><b>mutual exclusion</b>: to coordinate access to shared resources
</li>
<li><b>election</b>: to agree on a coordinator
</li>
<li><b>consensus</b>: to agree on some value
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> Distributed Mutex</h3>
<div class="outline-text-3" id="text-9-2">
</div><div id="outline-container-sec-9-2-1" class="outline-4">
<h4 id="sec-9-2-1"><span class="section-number-4">9.2.1</span> Overview</h4>
<div class="outline-text-4" id="text-9-2-1">
<p>
Objective:
</p>
<ul class="org-ul">
<li>prevents interference when a set of processes access shared resources
</li>
<li>extends critical section problem in OS
</li>
</ul>

<p>
Distributed mutex:
</p>
<ul class="org-ul">
<li>unlike standalone systems, in DS, neither shared variables nor facilities supplied by single local kernel can solve problem
</li>
<li>solution solely on <b>message passing</b>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-2-2" class="outline-4">
<h4 id="sec-9-2-2"><span class="section-number-4">9.2.2</span> System Model</h4>
<div class="outline-text-4" id="text-9-2-2">
<ul class="org-ul">
<li>N processes p<sub>1</sub>,..,p<sub>N</sub> that don't share variables
</li>
<li>enter critical section to access shared resources
<ul class="org-ul">
<li>application-level protocol for CS
<ul class="org-ul">
<li>enter()
</li>
<li>resourceAccess()
</li>
<li>exit()
</li>
</ul>
</li>
</ul>
</li>
<li>asynchronous sytem
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-2-3" class="outline-4">
<h4 id="sec-9-2-3"><span class="section-number-4">9.2.3</span> Requirements</h4>
<div class="outline-text-4" id="text-9-2-3">
<ul class="org-ul">
<li><b>safety</b>: &le; 1 process execute in CS at a time
</li>
<li><b>liveness</b>: eventually succeeds
<ul class="org-ul">
<li>no deadlock
</li>
<li>no starvation
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-2-4" class="outline-4">
<h4 id="sec-9-2-4"><span class="section-number-4">9.2.4</span> Performance Metrics</h4>
<div class="outline-text-4" id="text-9-2-4">
<ul class="org-ul">
<li><b>bandwidth consumption</b>: # of messages sent each entry and exit 
</li>
<li><b>client delay</b>: delay of each entry
</li>
<li><b>throughput</b>: rate at which set of processes can access CS
<ul class="org-ul">
<li>synchronization delay: between exiting process and next entering process
</li>
<li>focus on when process constantly wants to enter CS
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-2-5" class="outline-4">
<h4 id="sec-9-2-5"><span class="section-number-4">9.2.5</span> Central Server Algorithm</h4>
<div class="outline-text-4" id="text-9-2-5">
</div><ol class="org-ol"><li><a id="sec-9-2-5-1" name="sec-9-2-5-1"></a>Description<br  /><div class="outline-text-5" id="text-9-2-5-1">
<ul class="org-ul">
<li>server grants permission to enter CS
</li>
<li>to enter CS
<ol class="org-ol">
<li>request to server and waits
</li>
<li>if no other process has token, reply with token
</li>
<li>otherwise, queue request
</li>
</ol>
</li>
<li>to exit CS
<ol class="org-ol">
<li>send token to server
</li>
<li>server selects oldest request from queue
</li>
</ol>
</li>
</ul>
</div>
</li>
<li><a id="sec-9-2-5-2" name="sec-9-2-5-2"></a>Analysis<br  /><div class="outline-text-5" id="text-9-2-5-2">
<ul class="org-ul">
<li><b>safety</b>: only 1 token
</li>
<li><b>liveness</b>: FIFO ensures no deadlock/starvation
</li>
<li>not scalable due to centralized design
</li>
<li><b>bandwidth consumption</b>
<ul class="org-ul">
<li>entering: 2 messages
</li>
<li>exiting: 1 message
</li>
</ul>
</li>
<li><b>client delay</b>: 2 transmissions
</li>
<li><b>synchronization delay</b>: 2 transmissions
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-9-2-6" class="outline-4">
<h4 id="sec-9-2-6"><span class="section-number-4">9.2.6</span> Ring-Based Algorithms</h4>
<div class="outline-text-4" id="text-9-2-6">
<p>
Arrange processes in a logical ring. Circulate token around ring.
When received,
</p>
<ul class="org-ul">
<li>if not wanted, forward token
</li>
<li>if wanted, retain token &amp; enter CS
</li>
</ul>

<p>
To exit CS, simply forward token to neighbour.
</p>

<p>
Analysis
</p>
<ul class="org-ul">
<li><b>safety</b>: only one token
</li>
<li><b>liveness</b>: progress (no deadlock) and pass as soon as finish (no starvation)
</li>
<li>entry depends on location in ring, not necessarily on time order of request
</li>
<li><b>bandwidth consumption</b>
<ul class="org-ul">
<li>if every process wants to enter CS, good
</li>
<li>otherwise unbounded
</li>
</ul>
</li>
<li><b>client delay</b> &isin; [0,N] transmissions
</li>
<li><b>sync delay</b> &isin; [1,N] transmissions
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-2-7" class="outline-4">
<h4 id="sec-9-2-7"><span class="section-number-4">9.2.7</span> Ricart and Agrawala Algorithm</h4>
<div class="outline-text-4" id="text-9-2-7">
</div><ol class="org-ol"><li><a id="sec-9-2-7-1" name="sec-9-2-7-1"></a>Description<br  /><div class="outline-text-5" id="text-9-2-7-1">
<ul class="org-ul">
<li>require total ordering of events
<ul class="org-ul">
<li>e.g. use Lamport logical clocks and break ties with PID
</li>
</ul>
</li>
<li>process states &isin; {RELEASED,WANTED,HELD}
</li>
<li>entry
<ol class="org-ol">
<li>state = WANTED
</li>
<li>send requests to all other processes
</li>
<li>wait for N-1 replies
</li>
<li>enter CS, state = HELD
</li>
</ol>
</li>
<li>upon receival of request,
<ol class="org-ol">
<li>if state = RELEASED or (state = WANTED and T<sub>j</sub> &lt; T<sub>i</sub>)
<ul class="org-ul">
<li>reply
</li>
</ul>
</li>
<li>otherwise, queue request
</li>
</ol>
</li>
<li>exit
<ol class="org-ol">
<li>state = RELEASED
</li>
<li>reply all queued requests
</li>
</ol>
</li>
</ul>
</div>
</li>
<li><a id="sec-9-2-7-2" name="sec-9-2-7-2"></a>Analysis<br  /><div class="outline-text-5" id="text-9-2-7-2">
<ul class="org-ul">
<li><b>safety</b>: since requests are totally ordered, safe
</li>
<li><b>liveness</b>: FIFO queue &rarr; no deadlock, no starvation
</li>
<li><b>bandwidth consumption</b>: 2(N-1)
</li>
<li><b>client delay</b>: 2 transmissions
</li>
<li><b>sync delay</b>: 1 transmission
</li>
</ul>
</div>
</li></ol>
</div>
</div>
<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> Election</h3>
<div class="outline-text-3" id="text-9-3">
</div><div id="outline-container-sec-9-3-1" class="outline-4">
<h4 id="sec-9-3-1"><span class="section-number-4">9.3.1</span> Introduction</h4>
<div class="outline-text-4" id="text-9-3-1">
<ul class="org-ul">
<li>objective
<ul class="org-ul">
<li>choose unique process to play role, e.g. coordinator
</li>
<li>if current crash/retires, need election to choose new one
</li>
</ul>
</li>
<li>process initiates election if it starts particular run of election algo
<ul class="org-ul">
<li>1 process doesn't initiate &gt;1 election at a time
</li>
<li>diff processes may call elections concurrently
</li>
<li>more processes may fail during election
<ul class="org-ul">
<li>need to ensure non-crashed process is elected
</li>
</ul>
</li>
</ul>
</li>
<li>assume each process has PID
</li>
<li>WLOG, we require coordinator be chosen as process w/ largest PID
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-3-2" class="outline-4">
<h4 id="sec-9-3-2"><span class="section-number-4">9.3.2</span> Performance Metrics</h4>
<div class="outline-text-4" id="text-9-3-2">
<ul class="org-ul">
<li><b>bandwidth consumption</b>: total #messages sent
</li>
<li><b>T<sub>round</sub></b>: time between termination and initiation
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-3-3" class="outline-4">
<h4 id="sec-9-3-3"><span class="section-number-4">9.3.3</span> Ring-Based Algorithm</h4>
<div class="outline-text-4" id="text-9-3-3">
</div><ol class="org-ol"><li><a id="sec-9-3-3-1" name="sec-9-3-3-1"></a>Description<br  /><div class="outline-text-5" id="text-9-3-3-1">
<ul class="org-ul">
<li>assume asynchronous system and no failure
</li>
<li>process state &isin; {PARTICIPANT, NON<sub>PARTICIPANT</sub>}
</li>
<li>initially, each process is NON<sub>PARTICIPANT</sub>
</li>
<li>any process can initiate election:
<ol class="org-ol">
<li>mark self as participant
</li>
<li>place PID in election message
</li>
<li>send to successor
</li>
</ol>
</li>
<li>when process receives <b>election message</b>, compare message PID w/ own PID
<ul class="org-ul">
<li>if message PID &gt; own PID, forward
</li>
<li>if message PID &lt; own PID and NON<sub>PARTICIPANT</sub>, substitute &amp; forward
</li>
<li>if message PID &lt; own PID and PARTICIPANT, stop
</li>
<li>if message PID = own PID, be coordinator
</li>
</ul>
</li>
<li>coordinator becomes NON<sub>PARTICIPANT</sub> and sends <b>elected message</b> to neighbour, announce election, enclose identity
</li>
<li>when p<sub>i</sub> receives election message
<ul class="org-ul">
<li>p<sub>i</sub> becomes NON<sub>PARTICIPANT</sub>
</li>
<li>records coordinator PID
</li>
<li>p<sub>i</sub> forwards <b>elected message</b> to neighbour unless coordinator
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-9-3-3-2" name="sec-9-3-3-2"></a>Analysis<br  /><div class="outline-text-5" id="text-9-3-3-2">
<ul class="org-ul">
<li>correctness: involves all, unique even under concurrency
</li>
<li><b>bandwidth consumption</b>
<ul class="org-ul">
<li>suppose only 1 initiating process
</li>
<li>&le; N-1 election messages to get into largest
</li>
<li>N more election messages to confirm
</li>
<li>N elected messages for announcment of new coordinator
</li>
<li>i.e. total is 3N-1 messages
</li>
</ul>
</li>
<li><b>T<sub>round</sub></b>
<ul class="org-ul">
<li>3N-1 message transmissions since messages are sent sequentially
</li>
</ul>
</li>
</ul>
</div>
</li></ol>
</div>

<div id="outline-container-sec-9-3-4" class="outline-4">
<h4 id="sec-9-3-4"><span class="section-number-4">9.3.4</span> Bully Algorithm</h4>
<div class="outline-text-4" id="text-9-3-4">
</div><ol class="org-ol"><li><a id="sec-9-3-4-1" name="sec-9-3-4-1"></a>Description<br  /><div class="outline-text-5" id="text-9-3-4-1">
<ul class="org-ul">
<li>suppose p<sub>i</sub> knows processes p<sub>j</sub> s.t. PID(p<sub>j</sub>) &gt; PID(p<sub>i</sub>)
</li>
<li>three types of messages:
<ul class="org-ul">
<li><b>ELECTION</b>: announce election
</li>
<li><b>ANSWER</b>: respond to election message
</li>
<li><b>COORDINATOR</b>: announce identity of coordinator
</li>
</ul>
</li>
<li>if detect coordinator crash, begin election (may be concurrent)
</li>
<li>start election
<ol class="org-ol">
<li>P sends election message to all p<sub>j's</sub> and waits
</li>
<li>If within T no response, P wins and becomes coordinator
</li>
<li>If &exist; p<sub>j</sub> replying, P waits for coordinator message
</li>
</ol>
</li>
<li>upon receival of election message from smaller PID
<ol class="org-ol">
<li>send back answer message
</li>
<li>begin election if haven't
</li>
</ol>
</li>
<li>if crashed process comes back up
<ul class="org-ul">
<li>if largest decide coordinator and announce
</li>
<li>otherwise begin election
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-9-3-4-2" name="sec-9-3-4-2"></a>Analysis<br  /><div class="outline-text-5" id="text-9-3-4-2">
<ul class="org-ul">
<li>correctness
<ul class="org-ul">
<li>for any p<sub>i</sub>, p<sub>j</sub>, one with smaller PID discovers that the greater exists and defer to it
</li>
<li>unique
</li>
</ul>
</li>
<li><b>bandwidth consumption</b>
<ul class="org-ul">
<li>suppose coordinator crash
</li>
<li>best case: second largest detects crash &rarr; 1 election message + (N-2) COORDINATOR messages
</li>
<li>worst case: smallest detects crash &rarr; O(N) election messages, each starts O(N) elections &rarr; O(N<sup>2</sup>)
</li>
</ul>
</li>
<li><b>T<sub>round</sub></b>: T + 1 transmission
</li>
</ul>
</div>
</li></ol>
</div>
</div>
<div id="outline-container-sec-9-4" class="outline-3">
<h3 id="sec-9-4"><span class="section-number-3">9.4</span> Consensus Problem</h3>
<div class="outline-text-3" id="text-9-4">
</div><div id="outline-container-sec-9-4-1" class="outline-4">
<h4 id="sec-9-4-1"><span class="section-number-4">9.4.1</span> Introduction</h4>
<div class="outline-text-4" id="text-9-4-1">
<p>
Objective:
To agree on a value even in presence of failures after &ge; 1 processes proposed value
</p>
<ul class="org-ul">
<li>to transfer funds, processes must consistently agree to perform respective debit and credit
</li>
<li>in mutex, processes agree on who can enter CS
</li>
<li>in election, processes agree on who's the coordinator
</li>
<li>so consensus problem is a generalization
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-9-4-2" class="outline-4">
<h4 id="sec-9-4-2"><span class="section-number-4">9.4.2</span> System Model</h4>
<div class="outline-text-4" id="text-9-4-2">
<ul class="org-ul">
<li>N processes p<sub>1</sub>,..,p<sub>N</sub> communicating by message passing
</li>
<li>synchronous / asynchronous
</li>
<li>&le; f of N processes may fail
</li>
<li>every process p<sub>i</sub> begins in UNDECIDED state, proposes v<sub>i</sub>
</li>
<li>communicate to exchange values
</li>
<li>process p<sub>i</sub> sets value of a decision variable d<sub>i</sub> and enters DECIDED state
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-9-4-3" class="outline-4">
<h4 id="sec-9-4-3"><span class="section-number-4">9.4.3</span> Requirements</h4>
<div class="outline-text-4" id="text-9-4-3">
</div><ol class="org-ol"><li><a id="sec-9-4-3-1" name="sec-9-4-3-1"></a>Termination<br  /><div class="outline-text-5" id="text-9-4-3-1">
<p>
Each correct process must set its decision variable d<sub>i</sub>
</p>
</div>
</li>
<li><a id="sec-9-4-3-2" name="sec-9-4-3-2"></a>Agreement<br  /><div class="outline-text-5" id="text-9-4-3-2">
<p>
Decision values of of correct processes are same. d<sub>1</sub>=..=d<sub>N</sub>
</p>
</div>
</li>
<li><a id="sec-9-4-3-3" name="sec-9-4-3-3"></a>Integrity<br  /><div class="outline-text-5" id="text-9-4-3-3">
<p>
If correct processes all proposed same value, then all correct processes in DECIDED state has chosen that value
</p>
</div>
</li></ol>
</div>
<div id="outline-container-sec-9-4-4" class="outline-4">
<h4 id="sec-9-4-4"><span class="section-number-4">9.4.4</span> Synchronous</h4>
<div class="outline-text-4" id="text-9-4-4">
</div><ol class="org-ol"><li><a id="sec-9-4-4-1" name="sec-9-4-4-1"></a>Assumptions<br  /><div class="outline-text-5" id="text-9-4-4-1">
<p>
&le; f of N processes may crash
</p>
</div>
</li>
<li><a id="sec-9-4-4-2" name="sec-9-4-4-2"></a>In absence of process crash<br  /><div class="outline-text-5" id="text-9-4-4-2">
<ul class="org-ul">
<li>each process p<sub>i</sub> multicasts v<sub>i</sub> to p<sub>j</sub> &forall; j
</li>
<li>each p<sub>i</sub> waits until collected all N values and then evaluates a function to set decision variable
<ul class="org-ul">
<li>i.e. d<sub>i</sub> = f(v<sub>1</sub>,..,v<sub>N</sub>)
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-9-4-4-3" name="sec-9-4-4-3"></a>When process crash<br  /><div class="outline-text-5" id="text-9-4-4-3">
<ul class="org-ul">
<li>faulty process may crash in the middle of multicast
<ul class="org-ul">
<li>may not send values to all p<sub>j</sub>
</li>
</ul>
</li>
<li>need to guarantee processes still receive same set of values
</li>
</ul>
</div>
</li>
<li><a id="sec-9-4-4-4" name="sec-9-4-4-4"></a>Solution<br  /><div class="outline-text-5" id="text-9-4-4-4">
<ul class="org-ul">
<li>proceeds f+1 rounds
<ul class="org-ul">
<li>each round, correct processes multicast values to p<sub>j</sub>
</li>
<li>in the end of (f+1)<sup>th</sup> round, all correct processes that survive must have received same set of values
</li>
<li>then each process evaluates a function to set decision variable
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-9-4-4-5" name="sec-9-4-4-5"></a>Theorem<br  /><div class="outline-text-5" id="text-9-4-4-5">
<p>
Any algorithm to reach consensus despite &le; f crash failures requires &ge; f+1 rounds of message exchanges
</p>

<p>
This lower bound also applies to case of byzantine failures.
</p>
</div>
</li></ol>
</div>
<div id="outline-container-sec-9-4-5" class="outline-4">
<h4 id="sec-9-4-5"><span class="section-number-4">9.4.5</span> Asynchronous = Impossible</h4>
<div class="outline-text-4" id="text-9-4-5">
<p>
In synchronous, message exchanges take place in rounds. If no message received within the round, assume process to be crashed.
</p>

<p>
In asynchronous, a crashed process is indistinguishable from a slow one.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> Replication and Consistency</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> Introduction</h3>
<div class="outline-text-3" id="text-10-1">
<ul class="org-ul">
<li>maintains copies of data at multiple copies
</li>
<li>improve performance and scalability
</li>
<li>increase reliability and fault-tolerance
</li>
<li>have to keep replicas consistent
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-2" class="outline-3">
<h3 id="sec-10-2"><span class="section-number-3">10.2</span> System Model</h3>
<div class="outline-text-3" id="text-10-2">
<p>
Each logical data object is implemented by a collection of replicas
</p>
</div>
<div id="outline-container-sec-10-2-1" class="outline-4">
<h4 id="sec-10-2-1"><span class="section-number-4">10.2.1</span> Static vs Dynamic</h4>
<div class="outline-text-4" id="text-10-2-1">
<ul class="org-ul">
<li>static: contains fixed set of replicas
</li>
<li>dynamic: replicas may be created/destroyed on the fly (not considered)
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-2-2" class="outline-4">
<h4 id="sec-10-2-2"><span class="section-number-4">10.2.2</span> Transparency</h4>
<div class="outline-text-4" id="text-10-2-2">
<ul class="org-ul">
<li>clients unaware of replicas
</li>
<li>clients see logical objects only
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-2-3" class="outline-4">
<h4 id="sec-10-2-3"><span class="section-number-4">10.2.3</span> Data operations</h4>
<div class="outline-text-4" id="text-10-2-3">
<ul class="org-ul">
<li>read
</li>
<li>write
</li>
<li>atomic operations @ replicas
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-2-4" class="outline-4">
<h4 id="sec-10-2-4"><span class="section-number-4">10.2.4</span> Possible failures</h4>
<div class="outline-text-4" id="text-10-2-4">
<ul class="org-ul">
<li>crash (process omission)
</li>
<li>byzantine (process)
</li>
<li>Network partition
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-2-5" class="outline-4">
<h4 id="sec-10-2-5"><span class="section-number-4">10.2.5</span> Consistency model</h4>
<div class="outline-text-4" id="text-10-2-5">
<ul class="org-ul">
<li>read returns value that shows result of last write
</li>
<li>but due to network elay, replicas are not necessarily consistent all time
</li>
<li>consistency models
<ul class="org-ul">
<li>define what is "correct" behavior
</li>
<li>concern whether operations performed on collection of replicas produce results that meet correctness criteria
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-10-3" class="outline-3">
<h3 id="sec-10-3"><span class="section-number-3">10.3</span> Data-Centric Consistency Models</h3>
<div class="outline-text-3" id="text-10-3">
</div><div id="outline-container-sec-10-3-1" class="outline-4">
<h4 id="sec-10-3-1"><span class="section-number-4">10.3.1</span> Overview</h4>
<div class="outline-text-4" id="text-10-3-1">
<ul class="org-ul">
<li>target scenario: concurrent processes may simultaneously update data objects
</li>
<li>objective: to provide system-wide consistent view of data objects in face of concurrency
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-3-2" class="outline-4">
<h4 id="sec-10-3-2"><span class="section-number-4">10.3.2</span> Strict concurrency</h4>
<div class="outline-text-4" id="text-10-3-2">
<p>
Absolute time ordering of all operations
</p>
</div>
</div>
<div id="outline-container-sec-10-3-3" class="outline-4">
<h4 id="sec-10-3-3"><span class="section-number-4">10.3.3</span> Sequential concurrency</h4>
<div class="outline-text-4" id="text-10-3-3">
<ul class="org-ul">
<li>all clients see all operations in same order
</li>
<li>operations may not be ordered in absolute time
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-3-4" class="outline-4">
<h4 id="sec-10-3-4"><span class="section-number-4">10.3.4</span> Causal and FIFO</h4>
<div class="outline-text-4" id="text-10-3-4">
<p>
Different clients may see opeartions in different orders
</p>
</div>
<ol class="org-ol"><li><a id="sec-10-3-4-1" name="sec-10-3-4-1"></a>Causal concurrency<br  /><div class="outline-text-5" id="text-10-3-4-1">
<p>
All clients see causally-related operations in same order, but non-causally related operations may be viewed in different orders.
</p>
</div>
</li>
<li><a id="sec-10-3-4-2" name="sec-10-3-4-2"></a>FIFO concurrency<br  /><div class="outline-text-5" id="text-10-3-4-2">
<p>
All clients see writes from each other in the order they were issued, but other than that, can be seen in different orders.
</p>
</div>
</li></ol>
</div>
</div>
<div id="outline-container-sec-10-4" class="outline-3">
<h3 id="sec-10-4"><span class="section-number-3">10.4</span> Data-Centric Consistency Protocols</h3>
<div class="outline-text-3" id="text-10-4">
</div><div id="outline-container-sec-10-4-1" class="outline-4">
<h4 id="sec-10-4-1"><span class="section-number-4">10.4.1</span> Description</h4>
<div class="outline-text-4" id="text-10-4-1">
<p>
A consistency protocol describes an <b>implementation</b> of a specific consistency model.
</p>

<p>
We will look at fault-tolerant aspecs:
</p>
<ul class="org-ul">
<li>does it handle faults?
</li>
<li>what type of faults?
</li>
<li>how many faults can it tolerate?
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-4-2" class="outline-4">
<h4 id="sec-10-4-2"><span class="section-number-4">10.4.2</span> Primary-Based Protocols</h4>
<div class="outline-text-4" id="text-10-4-2">
</div><ol class="org-ol"><li><a id="sec-10-4-2-1" name="sec-10-4-2-1"></a>Overview<br  /><div class="outline-text-5" id="text-10-4-2-1">
<ul class="org-ul">
<li>one primary replica, several backups
</li>
<li>passive replication
</li>
<li>primary replica coordinates writes
</li>
<li>if primary crashes, elect primary from backups
</li>
<li>examples:
<ul class="org-ul">
<li>remote-write: fixed primary replica
</li>
<li>local-write: primary replica can be moved
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-10-4-2-2" name="sec-10-4-2-2"></a>Remote-write Protocol<br  /><ol class="org-ol"><li><a id="sec-10-4-2-2-1" name="sec-10-4-2-2-1"></a>Mechanism<br  /><div class="outline-text-6" id="text-10-4-2-2-1">
<ul class="org-ul">
<li>writes forwarded to primary
<ol class="org-ol">
<li>primary performs update and forwards update to replicas
</li>
<li>each backup performs update
</li>
<li>primary send ack back to client
</li>
<li>writes are blocking
</li>
</ol>
</li>
<li>reads at any replica
</li>
</ul>
</div>
</li>
<li><a id="sec-10-4-2-2-2" name="sec-10-4-2-2-2"></a>A sequential consistency implementation<br  /><div class="outline-text-6" id="text-10-4-2-2-2">
<ul class="org-ul">
<li>primary replica orders writes in globally unique order
</li>
<li>all clients see all writes in same order, no matter which replica they use to perform reads
</li>
<li>due to blocking, clients always see effects of most recent writes
</li>
</ul>
</div>
</li></ol>
</li>
<li><a id="sec-10-4-2-3" name="sec-10-4-2-3"></a>Local-write Protocol<br  /><div class="outline-text-5" id="text-10-4-2-3">
<ul class="org-ul">
<li>primary migrates between replicas that want to write
</li>
<li>writes can be non-blocking
<ol class="org-ol">
<li>return ack to client after primary updates
</li>
<li>primary tells backups to update
</li>
</ol>
</li>
<li>advantages:
<ul class="org-ul">
<li>multiple successive writes locally
</li>
<li>enable disconnected mode
</li>
</ul>
</li>
</ul>
</div>
</li>
<li><a id="sec-10-4-2-4" name="sec-10-4-2-4"></a>Fault tolerance<br  /><div class="outline-text-5" id="text-10-4-2-4">
<ul class="org-ul">
<li>can handle crashes
</li>
<li>to tolerate &le; f process crashes, must have f+1 replicas
</li>
<li>cannot deal with byzantine failures
<ul class="org-ul">
<li>only one replica executes operations
</li>
</ul>
</li>
</ul>
</div>
</li></ol>
</div>
<div id="outline-container-sec-10-4-3" class="outline-4">
<h4 id="sec-10-4-3"><span class="section-number-4">10.4.3</span> Replicated-Write Protocols</h4>
<div class="outline-text-4" id="text-10-4-3">
<p>
Writes at multiple replicas
</p>
</div>
<ol class="org-ol"><li><a id="sec-10-4-3-1" name="sec-10-4-3-1"></a>Active replication<br  /><ol class="org-ol"><li><a id="sec-10-4-3-1-1" name="sec-10-4-3-1-1"></a>Description<br  /><div class="outline-text-6" id="text-10-4-3-1-1">
<ul class="org-ul">
<li>all replicas play <b>same role</b>
</li>
<li>writes at all replicas
<ul class="org-ul">
<li>operations sent to all via <b>totally ordered multicast</b>
</li>
<li>all replicas start in same state and perform same operations in same order
</li>
<li>writes are blocking
</li>
<li>no action needed if a replica crash
</li>
</ul>
</li>
<li>reads at any replicas
</li>
</ul>
</div>
</li>
<li><a id="sec-10-4-3-1-2" name="sec-10-4-3-1-2"></a>Analysis<br  /><div class="outline-text-6" id="text-10-4-3-1-2">
<ul class="org-ul">
<li>achieves sequential consistency
<ul class="org-ul">
<li>totally ordered multicast orders all writes
</li>
</ul>
</li>
<li>fault tolerance
<ul class="org-ul">
<li>process omission:
<ul class="org-ul">
<li>client waits only for first response
</li>
</ul>
</li>
<li>byzantine:
<ul class="org-ul">
<li>to tolerate &le; f failures, 2f+1 replicas needed
</li>
<li>client waits for f+1 identical responses
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</li></ol>
</li>
<li><a id="sec-10-4-3-2" name="sec-10-4-3-2"></a>Gifford's quorum-based protocol<br  /><ol class="org-ol"><li><a id="sec-10-4-3-2-1" name="sec-10-4-3-2-1"></a>Introduction<br  /><ol class="org-ol"><li><a id="sec-10-4-3-2-1-1" name="sec-10-4-3-2-1-1"></a>Network Partitions<br  /><div class="outline-text-7" id="text-10-4-3-2-1-1">
<p>
A network partition separates group of replicas into &ge; 2 subgroups s.t.
</p>
<ul class="org-ul">
<li>replicas of same subgroup can communicate with one anothr
</li>
<li>replicas of different subgroups can't communicate with one another
</li>
</ul>

<p>
Partitions will eventually be repaired
</p>
<ul class="org-ul">
<li>must ensure any operation executed during partition won't make replicas inconsistent when partition is repaired
</li>
</ul>
</div>
</li>
<li><a id="sec-10-4-3-2-1-2" name="sec-10-4-3-2-1-2"></a>Handling Network Partitions<br  /><div class="outline-text-7" id="text-10-4-3-2-1-2">
<ul class="org-ul">
<li>Optimistic approach
<ul class="org-ul">
<li>allow updates in all partitions
<ul class="org-ul">
<li>&rarr; can lead to inconsistencies between partitions
</li>
</ul>
</li>
<li>resolve inconsistencies when partition is repaired
</li>
<li>unsuitable for banking
</li>
</ul>
</li>
<li>Pessimistic approach
<ul class="org-ul">
<li>allow updates in one partition only
<ul class="org-ul">
<li>&rarr; prevents inconsistencies
</li>
</ul>
</li>
<li>update remaining replicas when partition is repaired
</li>
<li>Gifford's quorum-based protocol
</li>
</ul>
</li>
</ul>
</div>
</li></ol>
</li>
<li><a id="sec-10-4-3-2-2" name="sec-10-4-3-2-2"></a>Design<br  /><div class="outline-text-6" id="text-10-4-3-2-2">
<ul class="org-ul">
<li><b>quorum</b>: subgroup of replicas whose size gives it right to perform operations
</li>
<li>writes may be performed by one quorum only
<ul class="org-ul">
<li>use version numbers
</li>
<li>writes only on latest replicas
</li>
</ul>
</li>
<li>reads only on a read quorum (&ge; R replicas)
</li>
<li>writes only on write quorum (&ge; W replicas)
</li>
<li>W &gt; 1/2 N
</li>
<li>R+W &gt; N
</li>
</ul>
</div>
</li>
<li><a id="sec-10-4-3-2-3" name="sec-10-4-3-2-3"></a>Operations<br  /><ol class="org-ol"><li><a id="sec-10-4-3-2-3-1" name="sec-10-4-3-2-3-1"></a>Read<br  /><div class="outline-text-7" id="text-10-4-3-2-3-1">
<p>
To perform read, client must assemble a read quorum
</p>
<ul class="org-ul">
<li>contact a set of &ge; R replicas
</li>
<li>set must contain at least one up-to-date replica
</li>
<li>read on any up-to-date replica
</li>
</ul>
</div>
</li>
<li><a id="sec-10-4-3-2-3-2" name="sec-10-4-3-2-3-2"></a>Write<br  /><div class="outline-text-7" id="text-10-4-3-2-3-2">
<p>
Must assemble write quorum
</p>
<ul class="org-ul">
<li>contact a set of &ge; W replicas
</li>
<li>set must contain at least one up-to-date replica
</li>
<li>sync out-of-date replicas
</li>
<li>write is then applied to each replica in write quorum
</li>
</ul>
</div>
</li></ol>
</li></ol>
</li></ol>
</div>
</div>
<div id="outline-container-sec-10-5" class="outline-3">
<h3 id="sec-10-5"><span class="section-number-3">10.5</span> Client-Centric Consistency Models</h3>
<div class="outline-text-3" id="text-10-5">
</div><div id="outline-container-sec-10-5-1" class="outline-4">
<h4 id="sec-10-5-1"><span class="section-number-4">10.5.1</span> Overview</h4>
<div class="outline-text-4" id="text-10-5-1">
<ul class="org-ul">
<li>target scenario
<ul class="org-ul">
<li>lack of simultaneous updates (or easy-to-be-resolved updates)
</li>
<li>most operations involve reading data
</li>
</ul>
</li>
<li>eventual consistency
<ul class="org-ul">
<li>if no update takes place for a long time, all replicas will gradually become consistent
</li>
<li>only requires that updates are guaranteed to propagaten (possibly lazy)
</li>
<li>eventual consistency works fine as long as clients always access same replica
</li>
<li>but problem if different replicas accessed
</li>
</ul>
</li>
<li>guarantees <b>for a single client</b> concerning conistency
</li>
<li>no guarantees for concurrent accesses
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-5-2" class="outline-4">
<h4 id="sec-10-5-2"><span class="section-number-4">10.5.2</span> Monotonic reads</h4>
<div class="outline-text-4" id="text-10-5-2">
<ul class="org-ul">
<li>if client reads value of x @ r<sub>i</sub>, any r<sub>j</sub> for which j&gt;i on x by that client will always return same value or a more recent value
</li>
<li>i.e. if seen x at t, will never see older version of x later
</li>
<li>e.g. distributed email database
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-5-3" class="outline-4">
<h4 id="sec-10-5-3"><span class="section-number-4">10.5.3</span> Monotonic writes</h4>
<div class="outline-text-4" id="text-10-5-3">
<p>
write operation w<sub>i</sub> by <b>a client</b> on x is completed before w<sub>j</sub> j&gt;i
</p>
</div>
</div>
<div id="outline-container-sec-10-5-4" class="outline-4">
<h4 id="sec-10-5-4"><span class="section-number-4">10.5.4</span> Read your writes</h4>
<div class="outline-text-4" id="text-10-5-4">
<p>
Effect of a write operation by a client on x will always be seen by subsequent read operation on x by same client
</p>
</div>
</div>
<div id="outline-container-sec-10-5-5" class="outline-4">
<h4 id="sec-10-5-5"><span class="section-number-4">10.5.5</span> Writes follow reads</h4>
<div class="outline-text-4" id="text-10-5-5">
<ul class="org-ul">
<li>write by client on x following read by same client on x is guaranteed to take place on same/more recent value of x that was read
</li>
<li>writes on x are performed on copy of x that is up-to-date with value most recently read by that client
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-10-6" class="outline-3">
<h3 id="sec-10-6"><span class="section-number-3">10.6</span> Client-Centric Consistency Protocols</h3>
<div class="outline-text-3" id="text-10-6">
<ul class="org-ul">
<li>each write is assigned a globally unique ID
<ul class="org-ul">
<li>can be assigned by origin replica of the write operation
</li>
</ul>
</li>
<li>each client keeps track of 2 sets of write operations
<ul class="org-ul">
<li>read set: IDs of writes relevant to read operations by client
</li>
<li>write set: IDs of writes performed by client
</li>
</ul>
</li>
</ul>

<p>
To implement monotonic-read consistency
</p>
<ul class="org-ul">
<li>when client performs read operation at a replica, that replica is handed the client's <b>read set</b> to check whether all identified writes have taken place locally
</li>
<li>if not, replica contacts other replicas to ensure it is brought up to date
</li>
<li>alternatively, read operation is forwarded to a replica where the identified writes have already taken place
</li>
<li>after read, write operations that have taken place at selected replica and which are relevant for read operation are added to client's read set
</li>
</ul>

<p>
Finally,
</p>
<ul class="org-ul">
<li>write ID could include ID of replica performing the write
</li>
<li>replica could be required to log the write operation so that it can be replayed at another replica
</li>
<li>other client-centric consistency models can be implemented in similar ways
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Eric Leonardo Lim</p>
<p class="date">Created: 2018-04-27 Fri 16:02</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
